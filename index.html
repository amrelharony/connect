<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Amr Elharony | Delivery Lead | Mentor | Fintech Author & Speaker</title>
    <meta name="description" content="Amr Elharony — Scrum Master at Banque Misr, FinTech author, and globally recognized mentor. Bridging banking and technology to deliver measurable digital transformation across MENA.">
    <meta name="author" content="Amr Elharony">
    <link rel="canonical" href="https://amrelharony.com">
    <meta property="og:type" content="profile"><meta property="og:title" content="Amr Elharony — Delivery Lead · Mentor · Fintech Author">
    <meta property="og:description" content="Bridging banking and technology to deliver measurable digital transformation. Author of The Bilingual Executive. 1,000+ mentoring minutes on ADPList.">
    <meta property="og:url" content="https://amrelharony.com"><meta property="og:image" content="https://amrelharony.com/profile.jpg">
    <meta property="og:site_name" content="Amr Elharony"><meta property="profile:first_name" content="Amr"><meta property="profile:last_name" content="Elharony">
    <meta name="twitter:card" content="summary"><meta name="twitter:title" content="Amr Elharony — Delivery Lead · Mentor · Fintech Author">
    <meta name="twitter:description" content="Bridging banking and technology to deliver measurable digital transformation across MENA.">
    <meta name="twitter:image" content="https://amrelharony.com/profile.jpg">
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Person","name":"Amr Elharony","url":"https://amrelharony.com","image":"https://amrelharony.com/profile.jpg","jobTitle":"Scrum Master","worksFor":{"@type":"Organization","name":"Banque Misr"},"description":"Delivery Lead, Mentor, FinTech Author & Speaker bridging banking and technology across MENA.","alumniOf":[{"@type":"CollegeOrUniversity","name":"Helwan University Cairo"},{"@type":"CollegeOrUniversity","name":"Frankfurt School of Finance & Management"}],"knowsAbout":["FinTech","Agile","Scrum","Digital Transformation","Data Analytics","Banking"],"sameAs":["https://www.linkedin.com/in/amrmelharony","https://t.me/Amrmelharony","https://adplist.org/mentors/amr-elharony"]}</script>
    <script>window.va=window.va||function(){(window.va.q=window.va.q||[]).push(arguments);};</script>
    <script defer src="/_vercel/insights/script.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&family=Noto+Sans+Arabic:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script>tailwind.config={theme:{extend:{fontFamily:{sans:['Inter','sans-serif'],mono:['JetBrains Mono','monospace'],ar:['Noto Sans Arabic','sans-serif']}}}}</script>
<style>
:root{--bg:#06080f;--bg2:#0c1018;--text:#f0f2f5;--sub:#6b7a90;--accent:#00e1ff;--accent2:#6366f1;--accent3:#a855f7;--card:rgba(255,255,255,0.025);--border:rgba(255,255,255,0.06);--cardH:rgba(255,255,255,0.07);--glow:rgba(0,225,255,0.15);--glowS:rgba(0,225,255,0.4)}
.light-mode{--bg:#f4f6fb;--bg2:#fff;--text:#0a0f1a;--sub:#5a6578;--accent:#0066ff;--accent2:#4f46e5;--accent3:#9333ea;--card:rgba(255,255,255,0.7);--border:rgba(0,0,0,0.06);--cardH:rgba(255,255,255,0.95);--glow:rgba(0,102,255,0.08);--glowS:rgba(0,102,255,0.2)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);overflow:hidden;-webkit-tap-highlight-color:transparent;transition:background .6s,color .6s}
@media(prefers-reduced-motion:reduce){*,*::before,*::after{animation-duration:0.01ms!important;animation-iteration-count:1!important;transition-duration:0.01ms!important}#preloader{display:none!important}#app{opacity:1!important}.rv{opacity:1!important;transform:none!important}body{overflow:auto!important;overflow-x:hidden!important}}

/* PRELOADER */
#preloader{position:fixed;inset:0;background:var(--bg);z-index:10000;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:background .6s}
.pre-line{font-family:'JetBrains Mono',monospace;font-size:10px;letter-spacing:3px;text-transform:uppercase;color:var(--sub);opacity:0}
.pre-ctr{font-family:'JetBrains Mono',monospace;font-size:72px;font-weight:700;color:var(--text);line-height:1;margin:16px 0;opacity:0}
.pre-bar{width:200px;height:1px;background:var(--border);position:relative;overflow:hidden;opacity:0}
.pre-fill{position:absolute;top:0;left:0;height:100%;width:0%;background:var(--accent);box-shadow:0 0 20px var(--glowS)}
.pre-stage{margin-top:24px;font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--accent);opacity:0;height:14px}

#bgC{position:fixed;inset:0;z-index:0}
.mesh{position:fixed;inset:0;z-index:-1;opacity:.4}
.mesh div{position:absolute;border-radius:50%;filter:blur(100px)}
.mesh .b1{width:50vw;height:50vw;background:var(--accent);opacity:.08;top:-15%;left:-10%;animation:mf1 20s ease-in-out infinite}
.mesh .b2{width:40vw;height:40vw;background:var(--accent2);opacity:.06;bottom:-10%;right:-10%;animation:mf2 25s ease-in-out infinite}
.mesh .b3{width:35vw;height:35vw;background:var(--accent3);opacity:.05;top:50%;left:50%;transform:translate(-50%,-50%);animation:mf3 18s ease-in-out infinite}
@keyframes mf1{0%,100%{transform:translate(0,0) scale(1)}33%{transform:translate(5vw,8vh) scale(1.1)}66%{transform:translate(-3vw,-5vh) scale(.95)}}
@keyframes mf2{0%,100%{transform:translate(0,0) scale(1)}33%{transform:translate(-8vw,-4vh) scale(1.15)}66%{transform:translate(4vw,6vh) scale(.9)}}
@keyframes mf3{0%,100%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-45%,-55%) scale(1.2)}}
.noise{position:fixed;inset:0;z-index:9998;pointer-events:none;opacity:.02;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");mix-blend-mode:overlay}
.cg{position:fixed;width:300px;height:300px;border-radius:50%;pointer-events:none;z-index:1;background:radial-gradient(circle,var(--glow) 0%,transparent 70%);transform:translate(-50%,-50%);opacity:0;transition:opacity .3s}
.cg.on{opacity:1}
.cd{position:fixed;width:6px;height:6px;background:var(--accent);border-radius:50%;pointer-events:none;z-index:9999;transform:translate(-50%,-50%);transition:width .25s cubic-bezier(.16,1,.3,1),height .25s cubic-bezier(.16,1,.3,1),background .25s,border .25s}
.cd.hov{width:44px;height:44px;background:transparent;border:1.5px solid var(--accent);opacity:.5}
@media(pointer:coarse){.cg,.cd{display:none!important}}
.sbar{position:fixed;top:0;left:0;height:2px;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2));z-index:1000}

/* TOP BUTTONS */
.top-btns{position:fixed;top:16px;right:16px;z-index:100;display:flex;flex-direction:column;gap:0;background:var(--card);border:1px solid var(--border);backdrop-filter:blur(20px);border-radius:20px;overflow:hidden;transition:all .3s}
.tbtn{width:32px;height:32px;border:none;background:transparent;color:var(--sub);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:11px;transition:all .2s;padding:0;position:relative}
.tbtn:hover{color:var(--accent)}
.tbtn .trophy-btn-dot{position:absolute;top:4px;right:4px}
.tb-toggle{display:none;width:32px;height:32px;border:none;background:transparent;color:var(--sub);cursor:pointer;font-size:14px;line-height:32px;text-align:center;padding:0}
@media(max-width:600px){
.tb-toggle{display:flex;align-items:center;justify-content:center}
.top-btns .tbtn{height:0;overflow:hidden;opacity:0;transition:height .25s ease,opacity .2s}
.top-btns.expanded .tbtn{height:32px;opacity:1}
.top-btns.expanded .tbtn[style*="display:none"]{height:0!important;opacity:0!important}
.top-btns.expanded{box-shadow:0 8px 24px rgba(0,0,0,.2)}
}
.tbtn:hover,.tbtn:focus-visible{color:var(--accent);border-color:var(--accent);transform:rotate(20deg) scale(1.05);outline:none}
.lang-btn{font-size:11px;font-weight:700;font-family:'JetBrains Mono',monospace}
.lang-btn:hover,.lang-btn:focus-visible{transform:scale(1.05);rotate:0deg}

#app{position:relative;z-index:2;width:100%;max-width:480px;margin:0 auto;padding:48px 24px 120px;opacity:0}
.rv{opacity:0;transform:translateY(30px)}

/* STATUS */
.st{display:inline-flex;align-items:center;gap:8px;padding:4px 12px;border-radius:100px;background:var(--card);border:1px solid var(--border);backdrop-filter:blur(20px);font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:1.5px;text-transform:uppercase;color:var(--sub)}
.sd{width:6px;height:6px;border-radius:50%;position:relative;flex-shrink:0}
.sd::after{content:'';position:absolute;inset:-3px;border-radius:50%;background:inherit;opacity:.4;animation:sp 2s ease-in-out infinite}
@keyframes sp{0%,100%{transform:scale(1);opacity:.4}50%{transform:scale(2);opacity:0}}

.pf{position:relative;width:120px;height:120px;margin:24px auto 8px;cursor:pointer}
.pf svg{position:absolute;inset:-8px;width:calc(100% + 16px);height:calc(100% + 16px)}
.pf svg circle{fill:none;stroke-width:1.5;stroke-linecap:round;stroke-dasharray:8 6;animation:rr 12s linear infinite;transform-origin:center}
@keyframes rr{to{transform:rotate(360deg)}}
.pfi{width:100%;height:100%;border-radius:50%;overflow:hidden;position:relative;z-index:2}
.pfi img{width:100%;height:100%;object-fit:cover;transition:transform .6s cubic-bezier(.16,1,.3,1)}
.pf:hover .pfi img{transform:scale(1.08)}
.fc{perspective:1000px;width:100%;height:100%;border-radius:50%}
.fi{position:relative;width:100%;height:100%;transition:transform .8s cubic-bezier(.175,.885,.32,1.275);transform-style:preserve-3d}
.fi.flipped{transform:rotateY(180deg)}
.ff,.fb{position:absolute;inset:0;backface-visibility:hidden;-webkit-backface-visibility:hidden;border-radius:50%;overflow:hidden}
.fb{transform:rotateY(180deg);background:var(--bg2);display:flex;align-items:center;justify-content:center;border:2px solid var(--border)}
.qb{position:absolute;bottom:2px;right:2px;width:24px;height:24px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;z-index:10;box-shadow:0 2px 8px rgba(0,0,0,.3);transition:transform .3s cubic-bezier(.16,1,.3,1)}
.pf:hover .qb{transform:scale(1.15)}
.qb i{font-size:10px;color:var(--bg)}
.ph{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--sub);opacity:.4;text-align:center;letter-spacing:1px;margin-bottom:20px}

.hn{font-size:28px;font-weight:800;text-align:center;letter-spacing:-.5px;line-height:1.2}
.ng{background:linear-gradient(135deg,var(--accent),var(--accent2));background-size:200% 200%;-webkit-background-clip:text;background-clip:text;color:transparent;animation:ns 6s ease-in-out infinite}
@keyframes ns{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
.sg{color:var(--accent);opacity:.5}
.vp{text-align:center;font-size:14px;color:var(--sub);line-height:1.6;margin:12px 0 4px;max-width:380px;margin-left:auto;margin-right:auto}
.vp strong{color:var(--text);font-weight:600}
.rl{display:flex;flex-wrap:wrap;justify-content:center;gap:6px;margin-top:10px}
.rt{font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:1.5px;text-transform:uppercase;padding:4px 10px;border-radius:4px;background:var(--card);border:1px solid var(--border);color:var(--sub);backdrop-filter:blur(10px);transition:all .3s}
.rt:hover{border-color:var(--accent);color:var(--accent)}

/* IMPACT STRIP */
.imp{display:flex;justify-content:center;gap:24px;margin:20px 0 4px;flex-wrap:wrap}
.imp-item{text-align:center}.imp-num{font-family:'JetBrains Mono',monospace;font-size:20px;font-weight:700;color:var(--accent);line-height:1.2}
.imp-label{font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:1.5px;text-transform:uppercase;color:var(--sub);margin-top:2px}

/* WEATHER WIDGET */
.weather-widget{position:fixed;top:16px;left:16px;z-index:100;display:flex;align-items:center;gap:6px;padding:4px 10px 4px 6px;border-radius:20px;background:var(--card);border:1px solid var(--border);backdrop-filter:blur(20px);font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--sub);opacity:0;transition:opacity .5s;cursor:default}
.weather-widget.show{opacity:1}
.weather-icon{font-size:16px;line-height:1}
.weather-temp{font-weight:600;color:var(--text)}
.weather-desc{font-size:7px;letter-spacing:.5px;opacity:.6}
/* SOCIAL PROOF TICKER */
.ticker-wrap{overflow:hidden;margin:16px -24px 0;position:relative}
.ticker-wrap::before,.ticker-wrap::after{content:'';position:absolute;top:0;bottom:0;width:40px;z-index:2;pointer-events:none}
.ticker-wrap::before{left:0;background:linear-gradient(90deg,var(--bg),transparent)}
.ticker-wrap::after{right:0;background:linear-gradient(90deg,transparent,var(--bg))}
.light-mode .ticker-wrap::before{background:linear-gradient(90deg,var(--bg),transparent)}
.light-mode .ticker-wrap::after{background:linear-gradient(90deg,transparent,var(--bg))}
.ticker{display:flex;animation:tickScroll 90s linear infinite;width:max-content}
.ticker:hover{animation-play-state:paused}
.tq{flex-shrink:0;padding:10px 24px;font-size:12px;color:var(--sub);font-style:italic;white-space:nowrap}
.tq strong{color:var(--text);font-style:normal;font-weight:600;font-size:10px}
@keyframes tickScroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}

/* CONFERENCE BADGES */
.conf-strip{display:flex;align-items:center;gap:16px;margin:12px 0 4px;overflow-x:auto;padding:8px 0;scrollbar-width:none;-ms-overflow-style:none;justify-content:center;flex-wrap:wrap}
.conf-strip::-webkit-scrollbar{display:none}
.conf-badge{font-family:'JetBrains Mono',monospace;font-size:7px;letter-spacing:1px;text-transform:uppercase;padding:4px 10px;border-radius:100px;background:var(--card);border:1px solid var(--border);color:var(--sub);white-space:nowrap;transition:all .3s;backdrop-filter:blur(10px)}
.conf-badge:hover{border-color:var(--accent);color:var(--accent)}

.sr{display:flex;gap:20px;justify-content:center;margin:24px 0 28px}
.si{color:var(--sub);font-size:20px;transition:color .3s,transform .3s cubic-bezier(.16,1,.3,1);position:relative;text-decoration:none}
.si:hover,.si:focus-visible{transform:translateY(-3px);outline:none}
.si::after{content:'';position:absolute;bottom:-6px;left:50%;width:0;height:2px;background:var(--accent);border-radius:1px;transform:translateX(-50%);transition:width .3s cubic-bezier(.16,1,.3,1)}
.si:hover::after,.si:focus-visible::after{width:20px}

.lk{display:flex;align-items:center;padding:14px 16px;border-radius:16px;background:var(--card);border:1px solid var(--border);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);text-decoration:none;color:var(--text);position:relative;overflow:hidden;transition:background .3s,border-color .3s,transform .4s cubic-bezier(.16,1,.3,1),box-shadow .4s;will-change:transform}
.lk:hover,.lk:focus-visible{background:var(--cardH);border-color:rgba(0,225,255,.12);box-shadow:0 8px 32px -8px var(--glow),0 0 0 1px var(--border);outline:none}
.light-mode .lk:hover,.light-mode .lk:focus-visible{border-color:rgba(0,102,255,.15);box-shadow:0 8px 32px -8px rgba(0,0,0,.08)}
.ls{position:absolute;inset:0;pointer-events:none;opacity:0;transition:opacity .3s;z-index:0}
.lk:hover .ls{opacity:1}
.lm{position:absolute;inset:0;background:linear-gradient(105deg,transparent 40%,var(--glow) 50%,transparent 60%);transform:translateX(-100%);pointer-events:none;z-index:1}
.lk:hover .lm{animation:shm .8s ease forwards}
@keyframes shm{to{transform:translateX(100%)}}
.li{width:44px;height:44px;border-radius:12px;background:var(--card);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;margin-right:14px;flex-shrink:0;position:relative;z-index:2;transition:border-color .3s}
.lk:hover .li{border-color:rgba(0,225,255,.15)}
.li img{width:26px;height:26px;object-fit:contain}
.li .fbi{display:none;font-size:18px}
.lb{flex:1;position:relative;z-index:2}.lt{font-weight:600;font-size:14px}
.lsu{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--sub);margin-top:2px}
.la{color:var(--sub);font-size:13px;position:relative;z-index:2;transition:color .3s,transform .3s cubic-bezier(.16,1,.3,1);opacity:.4}
.lk:hover .la{opacity:1;color:var(--accent);transform:translateX(3px)}

.nd{display:flex;align-items:center;gap:12px;margin:32px 0 16px;opacity:.3}
.ndl{flex:1;height:1px;background:var(--sub)}
.ndt{font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--accent);white-space:nowrap}
.nl{display:flex;align-items:center;padding:10px 14px;border-radius:12px;background:var(--card);border:1px solid var(--border);backdrop-filter:blur(20px);text-decoration:none;color:var(--sub);font-size:13px;font-weight:500;position:relative;overflow:hidden;transition:background .3s,color .3s,border-color .3s,transform .3s cubic-bezier(.16,1,.3,1)}
.nl:hover,.nl:focus-visible{background:var(--cardH);color:var(--text);transform:translateX(4px);outline:none}
.ni{width:28px;display:flex;justify-content:center;flex-shrink:0;font-size:14px}
.nlb{flex:1;position:relative}
.nlb::after{content:'';position:absolute;bottom:-2px;left:0;width:0;height:1px;background:var(--accent);transition:width .4s cubic-bezier(.16,1,.3,1)}
.nl:hover .nlb::after{width:100%}
.ne{font-size:10px;opacity:.3;transition:opacity .3s}.nl:hover .ne{opacity:.7}

/* CTA */
.vcb{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:12px 16px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:var(--bg);font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;border:none;cursor:pointer;position:relative;overflow:hidden;transition:transform .3s cubic-bezier(.16,1,.3,1),box-shadow .3s,background .4s;margin-bottom:4px;text-decoration:none}
.vcb:hover,.vcb:focus-visible{transform:translateY(-2px);box-shadow:0 8px 24px -4px var(--glowS);outline:none;color:var(--bg)}
.vcb:active{transform:translateY(0) scale(.98)}
.vcb i{font-size:14px;transition:transform .3s}.vcb:hover i{transform:translateY(2px)}
.vcb-shim{position:absolute;inset:0;background:linear-gradient(105deg,transparent 40%,rgba(255,255,255,.2) 50%,transparent 60%);transform:translateX(-100%);pointer-events:none}
.vcb:hover .vcb-shim{animation:shm .8s ease forwards}
.vcb-done{background:linear-gradient(135deg,#22c55e,#16a34a)!important}

#contactSecret{max-height:0;overflow:hidden;opacity:0;transition:max-height .6s cubic-bezier(.16,1,.3,1),opacity .5s,margin .4s;margin:0}
#contactSecret.revealed{max-height:200px;opacity:1;margin:8px 0 4px}
#contactSecret .sr{margin:8px 0 12px}
.shake-hint{font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:1.5px;text-transform:uppercase;color:var(--sub);opacity:.25;text-align:center;transition:opacity .4s;margin-bottom:4px;display:none}
.shake-hint.shaking{opacity:.6;animation:shakeHintPulse 1s ease-in-out infinite}
.shake-hint.unlocked{opacity:.8;color:var(--accent)}
@keyframes shakeHintPulse{0%,100%{opacity:.4}50%{opacity:.8}}
.desk-hint{font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:1.5px;text-transform:uppercase;color:var(--sub);opacity:.2;text-align:center;margin-top:2px;margin-bottom:4px;display:none}
.shake-bar{width:100%;height:2px;border-radius:1px;background:var(--border);margin:4px 0 0;overflow:hidden;opacity:0;transition:opacity .3s}
.shake-bar.active{opacity:1}
.shake-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:1px;transition:width .15s linear}

/* EASTER EGG */
#easterEgg{position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center;opacity:0;visibility:hidden;transition:opacity .4s,visibility .4s;backdrop-filter:blur(10px);pointer-events:none}
#easterEgg.show{opacity:1;visibility:visible;pointer-events:auto}
.egg-card{max-width:360px;width:90%;padding:32px;border-radius:20px;background:var(--bg2);border:1px solid var(--border);text-align:center;transform:scale(.8);transition:transform .5s cubic-bezier(.16,1,.3,1)}
#easterEgg.show .egg-card{transform:scale(1)}
.egg-emoji{font-size:48px;margin-bottom:16px}
.egg-title{font-family:'JetBrains Mono',monospace;font-size:12px;letter-spacing:2px;text-transform:uppercase;color:var(--accent);margin-bottom:12px}
.egg-text{font-size:14px;color:var(--sub);line-height:1.7}
.egg-close{margin-top:20px;font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--sub);opacity:.4;cursor:pointer}
.egg-close:hover{opacity:1;color:var(--accent)}

/* ARABIC MODE */
[dir="rtl"] .hn,[dir="rtl"] .vp,[dir="rtl"] .rt,[dir="rtl"] .lt,[dir="rtl"] .lsu,[dir="rtl"] .nlb,[dir="rtl"] .st,[dir="rtl"] .imp-label,[dir="rtl"] .tq{font-family:'Noto Sans Arabic','Inter',sans-serif}
[dir="rtl"] .vp{direction:rtl;text-align:center}
[dir="rtl"] .li{margin-right:0;margin-left:14px}

/* READING */
.reading-card{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:12px;background:var(--card);border:1px solid var(--border);backdrop-filter:blur(20px);margin:12px 0 0}
.reading-icon{width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:16px;color:var(--bg)}
.reading-meta{flex:1}.reading-label{font-family:'JetBrains Mono',monospace;font-size:7px;letter-spacing:1.5px;text-transform:uppercase;color:var(--accent);margin-bottom:2px}.reading-title{font-size:13px;font-weight:600}.reading-author{font-size:11px;color:var(--sub);margin-top:1px}
/* INSIGHTS */
.insight-card{padding:14px;border-radius:12px;background:var(--card);border:1px solid var(--border);backdrop-filter:blur(20px);margin-bottom:8px;transition:all .3s;text-decoration:none;display:block;color:var(--text)}.insight-card:hover{background:var(--cardH);border-color:rgba(0,225,255,.12);transform:translateX(4px)}
.insight-text{font-size:13px;line-height:1.6;color:var(--sub)}.insight-text strong{color:var(--text)}.insight-source{font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:1px;text-transform:uppercase;color:var(--accent);margin-top:6px;opacity:.6}
/* TIMELINE */
.tl-wrap{position:relative;padding-left:20px;margin:8px 0 12px}.tl-line{position:absolute;left:5px;top:0;bottom:0;width:1px;background:linear-gradient(180deg,var(--accent),var(--accent2),var(--accent3))}
.tl-item{position:relative;padding:8px 0 8px 16px;display:flex;align-items:flex-start;gap:8px}.tl-dot{position:absolute;left:-20px;top:12px;width:10px;height:10px;border-radius:50%;border:2px solid var(--accent);background:var(--bg);z-index:1;transition:all .3s}
.tl-item:hover .tl-dot{background:var(--accent);box-shadow:0 0 12px var(--glowS)}.tl-yr{font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:700;color:var(--accent);min-width:46px;flex-shrink:0}.tl-txt{font-size:12px;color:var(--sub);line-height:1.4}.tl-txt strong{color:var(--text);font-weight:600}
.tl-era .tl-txt{font-size:13px}.tl-era .tl-dot{width:12px;height:12px;left:-21px}
.tl-sub{padding:4px 0 4px 16px}.tl-sub .tl-dot{width:6px;height:6px;left:-18px;top:10px;border-width:1.5px;opacity:.6}.tl-sub .tl-txt{font-size:11px;opacity:.8}
[dir="rtl"] .tl-wrap{padding-left:0;padding-right:20px}[dir="rtl"] .tl-line{left:auto;right:5px}[dir="rtl"] .tl-item{padding-left:0;padding-right:16px}[dir="rtl"] .tl-dot{left:auto;right:-20px}
/* SHARE CARD OVERLAY */
#shareOverlay{position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.92);display:flex;align-items:center;justify-content:center;opacity:0;visibility:hidden;transition:opacity .4s,visibility .4s;backdrop-filter:blur(14px);pointer-events:none}
#shareOverlay.show{opacity:1;visibility:visible;pointer-events:auto}
.share-panel{width:94%;max-width:400px;border-radius:20px;background:var(--bg2);border:1px solid var(--border);transform:scale(.9);transition:transform .5s cubic-bezier(.16,1,.3,1);overflow:hidden}
#shareOverlay.show .share-panel{transform:scale(1)}
.share-card-preview{position:relative;overflow:hidden}
.share-canvas{display:block;width:100%;border-radius:0}
.share-tabs{display:flex;border-bottom:1px solid var(--border)}
.share-tab{flex:1;font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:1.5px;text-transform:uppercase;padding:10px;text-align:center;color:var(--sub);cursor:pointer;transition:all .3s;border:none;background:transparent;-webkit-tap-highlight-color:transparent}.share-tab.active{color:var(--accent);box-shadow:inset 0 -2px 0 var(--accent)}
.share-platforms{padding:12px 16px}
.share-platform-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.share-plat{display:flex;flex-direction:column;align-items:center;gap:4px;padding:10px 4px;border-radius:10px;border:1px solid var(--border);background:transparent;cursor:pointer;transition:all .3s;color:var(--sub);-webkit-tap-highlight-color:transparent}
.share-plat:hover,.share-plat:active{border-color:var(--accent);color:var(--accent);background:rgba(0,225,255,.03);transform:translateY(-2px)}
.share-plat-icon{font-size:20px;transition:transform .3s}.share-plat:hover .share-plat-icon{transform:scale(1.15)}
.share-plat-name{font-family:'JetBrains Mono',monospace;font-size:6px;letter-spacing:1px;text-transform:uppercase}
.share-qr-section{padding:12px 16px;display:none;text-align:center}
.share-qr-section.active{display:block}
.share-qr-canvas{border-radius:12px;border:1px solid var(--border);display:block;margin:0 auto}
.share-qr-label{font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--sub);margin-top:6px;letter-spacing:1px}
.share-card-section{padding:12px 16px;display:none}
.share-card-section.active{display:block}
.share-dl-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.share-dl-btn{font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:1px;text-transform:uppercase;padding:10px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--sub);cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center;gap:6px;-webkit-tap-highlight-color:transparent}.share-dl-btn:hover{border-color:var(--accent);color:var(--accent)}
.share-dl-btn.primary{border-color:var(--accent);color:var(--accent);background:rgba(0,225,255,.05)}
.share-copied{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-family:'JetBrains Mono',monospace;font-size:14px;letter-spacing:2px;text-transform:uppercase;color:#22c55e;background:rgba(0,0,0,.8);padding:12px 24px;border-radius:10px;opacity:0;transition:opacity .3s;pointer-events:none;z-index:10}
.share-copied.show{opacity:1}
.share-close{text-align:center;padding:8px;font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--sub);opacity:.3;cursor:pointer;border-top:1px solid var(--border)}.share-close:hover{opacity:1;color:var(--accent)}
/* STREAK & SOUND */
.streak{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--accent);opacity:.2;text-align:center;margin-top:4px;transition:opacity .3s}.streak:hover{opacity:.6}
/* ACHIEVEMENT TOAST */
.toast-container{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);z-index:9990;display:flex;flex-direction:column;gap:8px;align-items:center;pointer-events:none}
.toast{display:flex;align-items:center;gap:10px;padding:14px 20px;border-radius:14px;background:var(--bg2);border:1px solid var(--accent);backdrop-filter:blur(20px);box-shadow:0 8px 32px rgba(0,225,255,.25);font-family:'JetBrains Mono',monospace;transform:translateY(60px) scale(.8);opacity:0;transition:all .5s cubic-bezier(.16,1,.3,1);pointer-events:auto;max-width:90vw;position:relative;overflow:hidden}
.toast.show{transform:translateY(0) scale(1);opacity:1}
.toast-shimmer{position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(0,225,255,.06),transparent);animation:tshimmer 2s ease-in-out}
@keyframes tshimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
.toast-emoji{font-size:32px;flex-shrink:0;animation:tpop .5s cubic-bezier(.16,1,.3,1)}.toast.show .toast-emoji{animation:tpop .5s cubic-bezier(.16,1,.3,1) .2s both}
@keyframes tpop{0%{transform:scale(0) rotate(-30deg)}60%{transform:scale(1.3) rotate(5deg)}100%{transform:scale(1) rotate(0deg)}}
.toast-body{display:flex;flex-direction:column;gap:2px;position:relative;z-index:1}
.toast-title{font-size:10px;letter-spacing:1.5px;text-transform:uppercase;color:var(--accent);font-weight:700}
.toast-desc{font-size:11px;color:var(--sub)}
.toast-xp{font-size:9px;color:var(--accent3);margin-top:2px;letter-spacing:1px}
.toast-rarity{font-size:7px;letter-spacing:1.5px;text-transform:uppercase;margin-top:1px}
.toast.legendary{border-color:#fbbf24;box-shadow:0 8px 32px rgba(251,191,36,.3)}
.toast.legendary .toast-title{color:#fbbf24}
.toast.epic{border-color:#a855f7;box-shadow:0 8px 32px rgba(168,85,247,.25)}
.toast.epic .toast-title{color:#a855f7}
/* LEVEL UP TOAST */
.toast-levelup{border-color:#22c55e;box-shadow:0 8px 40px rgba(34,197,94,.3);background:linear-gradient(135deg,var(--bg2),rgba(34,197,94,.05))}
.toast-levelup .toast-title{color:#22c55e;font-size:12px}
/* TROPHY CASE - UPGRADED */
#trophyOverlay{position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.92);display:flex;align-items:center;justify-content:center;opacity:0;visibility:hidden;transition:opacity .4s,visibility .4s;backdrop-filter:blur(14px);pointer-events:none}
#trophyOverlay.show{opacity:1;visibility:visible;pointer-events:auto}
.trophy-panel{width:92%;max-width:420px;max-height:85vh;overflow-y:auto;padding:24px;border-radius:22px;background:var(--bg2);border:1px solid var(--border);transform:scale(.85);transition:transform .5s cubic-bezier(.16,1,.3,1)}
#trophyOverlay.show .trophy-panel{transform:scale(1)}
.trophy-panel::-webkit-scrollbar{width:3px}.trophy-panel::-webkit-scrollbar-track{background:transparent}.trophy-panel::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
.trophy-header{text-align:center;margin-bottom:20px}
.trophy-title{font-family:'JetBrains Mono',monospace;font-size:13px;letter-spacing:2px;text-transform:uppercase;color:var(--accent)}
.trophy-stats{display:flex;justify-content:center;gap:24px;margin:12px 0}
.trophy-stat{text-align:center}.trophy-stat-num{font-family:'JetBrains Mono',monospace;font-size:20px;font-weight:700;color:var(--text)}.trophy-stat-label{font-family:'JetBrains Mono',monospace;font-size:7px;letter-spacing:1.5px;text-transform:uppercase;color:var(--sub);margin-top:2px}
.trophy-ring-wrap{position:relative;width:100px;height:100px;margin:16px auto}
.trophy-ring-svg{transform:rotate(-90deg)}
.trophy-ring-bg{fill:none;stroke:var(--border);stroke-width:4}
.trophy-ring-fill{fill:none;stroke:url(#trophyGrad);stroke-width:4;stroke-linecap:round;transition:stroke-dashoffset 1.2s cubic-bezier(.16,1,.3,1)}
.trophy-ring-text{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.trophy-ring-pct{font-family:'JetBrains Mono',monospace;font-size:22px;font-weight:700;color:var(--text)}
.trophy-ring-sub{font-family:'JetBrains Mono',monospace;font-size:7px;letter-spacing:1px;text-transform:uppercase;color:var(--sub);margin-top:1px}
.trophy-xp-bar{margin:12px 0 6px;height:8px;border-radius:4px;background:var(--border);overflow:hidden;position:relative}
.trophy-xp-fill{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--accent),var(--accent2),var(--accent3));transition:width 1s cubic-bezier(.16,1,.3,1);position:relative}
.trophy-xp-fill::after{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.15),transparent);animation:xpshimmer 2s ease-in-out infinite}
@keyframes xpshimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
.trophy-level{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--sub);text-align:center;letter-spacing:1px}
.trophy-tier-label{font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--sub);margin:18px 0 8px;padding-bottom:4px;border-bottom:1px solid var(--border)}
.trophy-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.trophy-badge{display:flex;flex-direction:column;align-items:center;gap:5px;padding:12px 6px;border-radius:14px;background:var(--card);border:1px solid var(--border);text-align:center;transition:all .4s;position:relative;overflow:hidden;cursor:default}
.trophy-badge.unlocked{border-color:rgba(0,225,255,.15);background:rgba(0,225,255,.02)}
.trophy-badge.unlocked.legendary{border-color:rgba(251,191,36,.2);background:rgba(251,191,36,.03)}
.trophy-badge.unlocked.epic{border-color:rgba(168,85,247,.2);background:rgba(168,85,247,.03)}
.trophy-badge.unlocked.rare{border-color:rgba(59,130,246,.2);background:rgba(59,130,246,.03)}
.trophy-badge.locked{opacity:.25;filter:grayscale(1)}
.trophy-badge-emoji{font-size:30px;transition:transform .4s}.trophy-badge.unlocked:hover .trophy-badge-emoji{transform:scale(1.25) rotate(8deg)}
.trophy-badge-name{font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:.8px;text-transform:uppercase;color:var(--text);font-weight:600}
.trophy-badge-desc{font-size:8px;color:var(--sub);line-height:1.3}
.trophy-badge-rarity{font-family:'JetBrains Mono',monospace;font-size:6px;letter-spacing:1.5px;text-transform:uppercase;margin-top:1px;padding:2px 6px;border-radius:4px}
.trophy-badge-rarity.common{color:#6b7a90;background:rgba(107,122,144,.1)}
.trophy-badge-rarity.rare{color:#3b82f6;background:rgba(59,130,246,.1)}
.trophy-badge-rarity.epic{color:#a855f7;background:rgba(168,85,247,.1)}
.trophy-badge-rarity.legendary{color:#fbbf24;background:rgba(251,191,36,.1)}
.trophy-badge-time{font-family:'JetBrains Mono',monospace;font-size:6px;color:var(--sub);opacity:.5;margin-top:1px}
.trophy-close{text-align:center;margin-top:16px;font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--sub);opacity:.4;cursor:pointer}.trophy-close:hover{opacity:1;color:var(--accent)}
.trophy-share-btn{display:block;margin:12px auto 0;font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:1.5px;text-transform:uppercase;padding:8px 20px;border-radius:8px;border:1px solid var(--accent);background:transparent;color:var(--accent);cursor:pointer;transition:all .3s}.trophy-share-btn:hover{background:rgba(0,225,255,.1)}
/* XP BAR (footer) - enhanced */
.xp-footer{display:flex;align-items:center;gap:8px;justify-content:center;margin-top:8px;opacity:.25;transition:opacity .3s;cursor:pointer}.xp-footer:hover{opacity:.7}
.xp-bar-mini{width:100px;height:4px;border-radius:2px;background:var(--border);overflow:hidden;position:relative}.xp-bar-fill{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .5s}
.xp-text{font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--sub);letter-spacing:1px}
.xp-level-badge{font-family:'JetBrains Mono',monospace;font-size:7px;padding:2px 6px;border-radius:4px;letter-spacing:1px;font-weight:700}
/* TROPHY BUTTON */
.trophy-btn{font-size:12px;position:relative}
.trophy-btn-dot{position:absolute;top:2px;right:2px;width:6px;height:6px;border-radius:50%;background:#22c55e;animation:pulse 2s ease-in-out infinite}
/* COMBO INDICATOR */
.combo-indicator{position:fixed;top:60px;right:16px;z-index:100;font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--accent);opacity:0;transition:all .4s;pointer-events:none;text-align:right}
.combo-indicator.show{opacity:1}
.combo-count{font-size:20px;font-weight:700;line-height:1}
.combo-label{font-size:7px;letter-spacing:1.5px;text-transform:uppercase;color:var(--sub);margin-top:2px}
.combo-mult{font-size:9px;color:var(--accent3)}
/* LIVE CONSOLE */
.live-console{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--accent);opacity:.25;text-align:center;margin-top:8px;min-height:14px;letter-spacing:.5px;transition:opacity .3s}.live-console:hover{opacity:.6}
.live-console .cursor-blink{animation:cblink 1s step-end infinite}
@keyframes cblink{50%{opacity:0}}
/* SMART CTA */
.smart-cta{position:fixed;bottom:0;left:0;right:0;z-index:100;padding:16px 24px;background:linear-gradient(180deg,transparent,var(--bg) 30%);display:flex;justify-content:center;transform:translateY(100%);transition:transform .6s cubic-bezier(.16,1,.3,1);pointer-events:none}
.smart-cta.show{transform:translateY(0);pointer-events:auto}
.smart-cta-inner{display:flex;align-items:center;gap:10px;padding:12px 20px;border-radius:12px;background:var(--bg2);border:1px solid var(--accent);backdrop-filter:blur(20px);box-shadow:0 -4px 24px rgba(0,225,255,.15);max-width:400px;width:100%;text-decoration:none;color:var(--text);transition:all .3s}
.smart-cta-inner:hover{box-shadow:0 -4px 32px rgba(0,225,255,.3);transform:translateY(-2px)}
.smart-cta-icon{font-size:18px;color:var(--accent)}.smart-cta-text{flex:1}.smart-cta-title{font-size:12px;font-weight:600}.smart-cta-sub{font-size:9px;color:var(--sub);font-family:'JetBrains Mono',monospace;margin-top:2px}
.smart-cta-close{color:var(--sub);cursor:pointer;padding:4px;font-size:12px;opacity:.5;transition:opacity .3s}.smart-cta-close:hover{opacity:1}
/* PERSONALIZED RECS */
.rec-card{display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:10px;background:var(--card);border:1px solid var(--border);margin-top:8px;text-decoration:none;color:var(--text);transition:all .3s}
.rec-card:hover{border-color:rgba(0,225,255,.15);background:var(--cardH);transform:translateX(4px)}
.rec-icon{font-size:16px;color:var(--accent);flex-shrink:0}.rec-meta{flex:1}.rec-label{font-family:'JetBrains Mono',monospace;font-size:7px;letter-spacing:1.5px;text-transform:uppercase;color:var(--accent3);margin-bottom:1px}.rec-title{font-size:12px;font-weight:600}
/* CERTIFICATION WALL */
.cert-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin:8px 0 12px}
.cert-card{display:flex;flex-direction:column;align-items:center;gap:6px;padding:12px 6px;border-radius:12px;background:var(--card);border:1px solid var(--border);backdrop-filter:blur(20px);text-decoration:none;color:var(--text);transition:all .4s;text-align:center;position:relative;overflow:hidden}
.cert-card::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(0,225,255,.04),transparent);opacity:0;transition:opacity .3s}.cert-card:hover::before{opacity:1}
.cert-card:hover{border-color:rgba(0,225,255,.15);transform:translateY(-3px);box-shadow:0 8px 24px rgba(0,225,255,.08)}
.cert-icon{font-size:24px;transition:transform .3s}.cert-card:hover .cert-icon{transform:scale(1.15)}
.cert-name{font-family:'JetBrains Mono',monospace;font-size:7px;letter-spacing:.5px;text-transform:uppercase;line-height:1.3;color:var(--sub)}.cert-name strong{color:var(--text);display:block;font-size:8px;margin-bottom:1px}
.cert-org{font-size:7px;color:var(--accent);opacity:.6;font-family:'JetBrains Mono',monospace;letter-spacing:.5px}
.cert-verify{position:absolute;top:4px;right:4px;width:14px;height:14px;border-radius:50%;background:rgba(34,197,94,.15);display:flex;align-items:center;justify-content:center;font-size:7px;color:#22c55e;opacity:0;transition:opacity .3s}.cert-card:hover .cert-verify{opacity:1}
@media(max-width:380px){.cert-grid{grid-template-columns:repeat(2,1fr)}}
/* MICRO-ANIMATIONS (scroll-triggered) */
.sa{opacity:0;transition:opacity .8s,transform .8s cubic-bezier(.16,1,.3,1)}.sa.vis{opacity:1;transform:none!important}
.sa-up{transform:translateY(30px)}.sa-left{transform:translateX(-30px)}.sa-right{transform:translateX(30px)}.sa-scale{transform:scale(.9)}.sa-rotate{transform:rotate(-3deg) translateY(20px)}
.foot{text-align:center;margin-top:12px;font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--sub);opacity:.25;transition:opacity .3s}
.foot:hover{opacity:.7}
.visitor-count{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--sub);opacity:.15;text-align:center;margin-top:8px;transition:opacity .3s}
.visitor-count:hover{opacity:.5}
/* TERMINAL */
#termOverlay{position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.95);display:flex;align-items:center;justify-content:center;opacity:0;visibility:hidden;transition:opacity .4s,visibility .4s;pointer-events:none}
#termOverlay.show{opacity:1;visibility:visible;pointer-events:auto}
.term-win{width:94%;max-width:520px;max-height:80vh;border-radius:14px;background:#0d1117;border:1px solid #30363d;overflow:hidden;transform:scale(.9);transition:transform .5s cubic-bezier(.16,1,.3,1);display:flex;flex-direction:column}
#termOverlay.show .term-win{transform:scale(1)}
.term-bar{display:flex;align-items:center;gap:6px;padding:10px 14px;background:#161b22;border-bottom:1px solid #30363d}
.term-dot{width:10px;height:10px;border-radius:50%}.term-dot.r{background:#ff5f57}.term-dot.y{background:#febc2e}.term-dot.g{background:#28c840}
.term-title{flex:1;text-align:center;font-family:'JetBrains Mono',monospace;font-size:10px;color:#8b949e;letter-spacing:1px}
.term-body{padding:16px;overflow-y:auto;flex:1;max-height:60vh;font-family:'JetBrains Mono',monospace;font-size:11px;line-height:1.7;color:#c9d1d9}
.term-line{margin-bottom:4px}.term-prompt{color:#58a6ff}.term-cmd{color:#c9d1d9}.term-out{color:#8b949e;margin-left:12px}.term-accent{color:#00e1ff}.term-green{color:#3fb950}.term-warn{color:#d29922}
.term-input-line{display:flex;align-items:center;gap:6px;padding:8px 16px;border-top:1px solid #30363d;background:#0d1117}
.term-input{flex:1;background:transparent;border:none;outline:none;color:#c9d1d9;font-family:'JetBrains Mono',monospace;font-size:11px;caret-color:#58a6ff}
/* FINTECH TRADER GAME */
#gameOverlay{position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.96);display:flex;align-items:center;justify-content:center;opacity:0;visibility:hidden;transition:opacity .4s,visibility .4s;pointer-events:none}
#gameOverlay.show{opacity:1;visibility:visible;pointer-events:auto}
.game-win{width:96%;max-width:380px;border-radius:16px;background:linear-gradient(180deg,#080c14,#0d1420);border:1px solid #1a2332;overflow:hidden;transform:scale(.9);transition:transform .5s cubic-bezier(.16,1,.3,1);text-align:center;padding:0}
#gameOverlay.show .game-win{transform:scale(1)}
.game-hud{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:#0a0f1a;border-bottom:1px solid #1a2332}
.game-hud-item{text-align:center}
.game-hud-val{font-family:'JetBrains Mono',monospace;font-size:14px;font-weight:700;color:#00e1ff;line-height:1}
.game-hud-val.profit{color:#22c55e}.game-hud-val.loss{color:#ef4444}
.game-hud-label{font-family:'JetBrains Mono',monospace;font-size:6px;letter-spacing:1.5px;text-transform:uppercase;color:#4a5568;margin-top:2px}
.game-ticker{font-family:'JetBrains Mono',monospace;font-size:8px;color:#4a5568;padding:4px 14px;background:#060a12;overflow:hidden;white-space:nowrap;border-bottom:1px solid #111827}
.game-ticker span{display:inline-block;animation:tickscroll 80s linear infinite}
@keyframes tickscroll{0%{transform:translateX(100%)}100%{transform:translateX(-100%)}}
.game-ticker .up{color:#22c55e}.game-ticker .down{color:#ef4444}
.game-canvas-wrap{padding:8px;position:relative}
.game-canvas{border:1px solid #1a2332;border-radius:8px;display:block;margin:0 auto;max-width:100%;touch-action:none;background:#080c14}
.game-level-bar{display:flex;align-items:center;gap:6px;padding:0 14px;margin-top:2px}
.game-level-text{font-family:'JetBrains Mono',monospace;font-size:7px;color:#4a5568;letter-spacing:1px;flex-shrink:0}
.game-level-track{flex:1;height:3px;border-radius:2px;background:#111827;overflow:hidden}
.game-level-fill{height:100%;border-radius:2px;background:linear-gradient(90deg,#00e1ff,#6366f1);transition:width .3s}
.game-msg{font-family:'JetBrains Mono',monospace;font-size:10px;color:#8b949e;padding:6px 14px;min-height:24px}
.game-msg .bonus{color:#fbbf24}.game-msg .warn{color:#ef4444}
.game-hint{font-family:'JetBrains Mono',monospace;font-size:7px;color:#2d3748;padding:0 14px 4px}
.game-btns{display:flex;gap:8px;justify-content:center;padding:8px 14px}
.game-btn{font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:1px;text-transform:uppercase;padding:7px 16px;border-radius:6px;border:1px solid #1a2332;background:#0d1420;color:#6b7280;cursor:pointer;transition:all .2s;-webkit-tap-highlight-color:transparent;flex:1}.game-btn:hover,.game-btn:active{border-color:#00e1ff;color:#00e1ff}
@media(max-width:600px){.game-hint{display:none}}
/* KEYBOARD SHORTCUTS */
#shortcutOverlay{position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.9);display:flex;align-items:center;justify-content:center;opacity:0;visibility:hidden;transition:opacity .4s,visibility .4s;backdrop-filter:blur(12px);pointer-events:none}
#shortcutOverlay.show{opacity:1;visibility:visible;pointer-events:auto}
.shortcut-panel{width:90%;max-width:360px;padding:24px;border-radius:16px;background:var(--bg2);border:1px solid var(--border);transform:scale(.9);transition:transform .4s cubic-bezier(.16,1,.3,1)}
#shortcutOverlay.show .shortcut-panel{transform:scale(1)}
.sc-title{font-family:'JetBrains Mono',monospace;font-size:12px;letter-spacing:2px;text-transform:uppercase;color:var(--accent);text-align:center;margin-bottom:16px}
.sc-row{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--border)}
.sc-key{font-family:'JetBrains Mono',monospace;font-size:10px;padding:3px 8px;border-radius:5px;background:var(--card);border:1px solid var(--border);color:var(--text);min-width:24px;text-align:center}
.sc-desc{font-size:11px;color:var(--sub)}
.sc-close{text-align:center;margin-top:12px;font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--sub);opacity:.4;cursor:pointer}.sc-close:hover{opacity:1;color:var(--accent)}
/* CURSOR TRAIL */
.cursor-particle{position:fixed;pointer-events:none;z-index:9990;width:4px;height:4px;border-radius:50%;background:var(--accent);opacity:0;transition:none}
/* TESTIMONIAL CAROUSEL */
.tc-section{margin:8px 0 12px}
.tc-cats{display:flex;gap:6px;overflow-x:auto;padding:2px 0 8px;scrollbar-width:none;-webkit-overflow-scrolling:touch}
.tc-cats::-webkit-scrollbar{display:none}
.tc-cat{font-family:'JetBrains Mono',monospace;font-size:7px;letter-spacing:1px;text-transform:uppercase;padding:5px 10px;border-radius:20px;border:1px solid var(--border);background:transparent;color:var(--sub);cursor:pointer;white-space:nowrap;transition:all .3s;-webkit-tap-highlight-color:transparent;flex-shrink:0}
.tc-cat.active{border-color:var(--accent);color:var(--accent);background:rgba(0,225,255,.06)}
.tc-cat .tc-cat-count{opacity:.4;margin-left:3px}
.tc-viewport{position:relative;overflow:hidden;min-height:160px}
.tc-track{display:flex;transition:transform .5s cubic-bezier(.16,1,.3,1)}
.tc-slide{min-width:100%;padding:0 2px;box-sizing:border-box}
.tc-card{padding:16px;border-radius:14px;background:var(--card);border:1px solid var(--border);backdrop-filter:blur(20px);transition:border-color .3s;min-height:130px;display:flex;flex-direction:column}
.tc-card:hover{border-color:rgba(0,225,255,.1)}
.tc-quote{font-size:12px;line-height:1.65;color:var(--sub);flex:1;position:relative;padding-left:16px}
.tc-quote::before{content:'"';position:absolute;left:0;top:-4px;font-size:28px;color:var(--accent);opacity:.25;font-family:Georgia,serif;line-height:1}
.tc-author{display:flex;align-items:center;gap:8px;margin-top:10px;padding-top:10px;border-top:1px solid var(--border)}
.tc-avatar{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0;font-weight:700;color:#fff}
.tc-info{flex:1;min-width:0}.tc-name{font-size:11px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.tc-role{font-size:8px;color:var(--sub);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.tc-cat-badge{font-family:'JetBrains Mono',monospace;font-size:6px;letter-spacing:1px;text-transform:uppercase;padding:2px 6px;border-radius:4px;margin-left:auto;flex-shrink:0;white-space:nowrap}
.tc-nav{display:flex;align-items:center;justify-content:center;gap:12px;margin-top:8px}
.tc-arrow{width:28px;height:28px;border-radius:50%;border:1px solid var(--border);background:transparent;color:var(--sub);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s;font-size:10px;-webkit-tap-highlight-color:transparent}.tc-arrow:hover{border-color:var(--accent);color:var(--accent)}
.tc-dots{display:flex;gap:4px;align-items:center}
.tc-dot{width:4px;height:4px;border-radius:50%;background:var(--border);transition:all .3s;cursor:pointer}.tc-dot.active{width:16px;border-radius:2px;background:var(--accent)}
.tc-counter{font-family:'JetBrains Mono',monospace;font-size:7px;color:var(--sub);letter-spacing:1px;text-align:center;margin-top:4px;opacity:.4}
.tc-auto-bar{height:2px;border-radius:1px;background:var(--border);margin-top:6px;overflow:hidden}
.tc-auto-fill{height:100%;border-radius:1px;background:var(--accent);opacity:.3;width:0%;transition:width 6s linear}
.tc-auto-fill.running{width:100%}
/* PRINT RESUME */
@media print{body{background:#fff!important;color:#000!important;overflow:visible!important}#preloader,.noise,.sbar,.cg,.cd,.mesh,#bgC,.top-btns,.weather-widget,.toast-container,.combo-indicator,.smart-cta,.xp-footer,.live-console,.visitor-count,.streak,.foot,#trophyOverlay,#shortcutOverlay,#termOverlay,#gameOverlay,#shareOverlay,#easterEgg,canvas,.vcb,.rec-card,#recContainer{display:none!important}.rv{opacity:1!important;transform:none!important}#app{opacity:1!important;max-width:700px;margin:0 auto;padding:20px}.sa{opacity:1!important;transform:none!important}.print-only{display:block!important}.cert-card{break-inside:avoid;page-break-inside:avoid;border-color:#ddd!important;background:#fff!important}*{color:#000!important;border-color:#ddd!important}}
.print-only{display:none}
</style>
</head>
<body>
<div class="noise"></div>
<div class="sbar" id="sbar"></div>
<div class="cg" id="cg"></div>
<div class="cd" id="cdd"></div>
<div class="mesh"><div class="b1"></div><div class="b2"></div><div class="b3"></div></div>
<canvas id="bgC" aria-hidden="true"></canvas>

<div class="weather-widget" id="weatherWidget"><span class="weather-icon" id="weatherIcon">⏳</span><span class="weather-temp" id="weatherTemp">--°C</span></div>
<div class="top-btns" id="topBtns">
    <button class="tb-toggle" id="tbToggle" aria-label="Menu">⋮</button>
    <button class="tbtn" id="termBtn" aria-label="Open terminal" onclick="openTerm()" style="display:none"><i class="fa-solid fa-terminal"></i></button>
    <button class="tbtn" id="gameBtn" aria-label="Play game" onclick="openGame()" style="display:none"><i class="fa-solid fa-gamepad"></i></button>
    <button class="tbtn trophy-btn" id="trophyBtn" aria-label="Trophy case" style="display:none"><i class="fa-solid fa-trophy"></i><span class="trophy-btn-dot" id="trophyDot" style="display:none"></span></button>
    <button class="tbtn" id="tbtn" aria-label="Toggle theme"><i class="fa-solid fa-moon" id="ticon"></i></button>
</div>

<div id="easterEgg" onclick="if(event.target===this)closeEgg()">
    <div class="egg-card">
        <div class="egg-emoji">🤫</div>
        <div class="egg-title">You found a secret!</div>
        <div class="egg-text" id="eggText">
            Fun facts: I once debugged a production banking system at 3 AM in my pajamas. My first "app" was an Excel macro that automated my entire department's reporting. I believe the best code is the code you delete. Also — I make really good koshari. 🍲
        </div>
        <div class="egg-close" onclick="closeEgg()">[ PRESS ESC OR TAP TO CLOSE ]</div>
    </div>
</div>

<div id="shareOverlay" onclick="if(event.target===this)closeShare()"><div class="share-panel" style="position:relative">
    <button onclick="closeShare()" style="position:absolute;top:10px;right:10px;width:28px;height:28px;border-radius:50%;border:1px solid var(--border);background:var(--card);color:var(--sub);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:12px;z-index:2;transition:all .3s" onmouseover="this.style.borderColor='var(--accent)';this.style.color='var(--accent)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--sub)'"><i class="fa-solid fa-xmark"></i></button>
    <div class="share-card-preview"><canvas id="shareCanvas" class="share-canvas" width="600" height="340"></canvas><div class="share-copied" id="shareCopied">✓ Copied!</div></div>
    <div class="share-tabs">
        <button class="share-tab active" data-tab="platforms"><i class="fa-solid fa-share-nodes" style="margin-right:4px"></i>Share</button>
        <button class="share-tab" data-tab="qr"><i class="fa-solid fa-qrcode" style="margin-right:4px"></i>QR Code</button>
        <button class="share-tab" data-tab="card"><i class="fa-solid fa-download" style="margin-right:4px"></i>Save Card</button>
    </div>
    <div class="share-platforms share-tab-content active" data-content="platforms">
        <div class="share-platform-grid">
            <button class="share-plat" data-platform="linkedin"><div class="share-plat-icon"><i class="fa-brands fa-linkedin"></i></div><div class="share-plat-name">LinkedIn</div></button>
            <button class="share-plat" data-platform="twitter"><div class="share-plat-icon"><i class="fa-brands fa-x-twitter"></i></div><div class="share-plat-name">X / Twitter</div></button>
            <button class="share-plat" data-platform="whatsapp"><div class="share-plat-icon"><i class="fa-brands fa-whatsapp"></i></div><div class="share-plat-name">WhatsApp</div></button>
            <button class="share-plat" data-platform="telegram"><div class="share-plat-icon"><i class="fa-brands fa-telegram"></i></div><div class="share-plat-name">Telegram</div></button>
            <button class="share-plat" data-platform="email"><div class="share-plat-icon"><i class="fa-solid fa-envelope"></i></div><div class="share-plat-name">Email</div></button>
            <button class="share-plat" data-platform="facebook"><div class="share-plat-icon"><i class="fa-brands fa-facebook"></i></div><div class="share-plat-name">Facebook</div></button>
            <button class="share-plat" data-platform="copy"><div class="share-plat-icon"><i class="fa-solid fa-link"></i></div><div class="share-plat-name">Copy Link</div></button>
            <button class="share-plat" data-platform="native"><div class="share-plat-icon"><i class="fa-solid fa-arrow-up-from-bracket"></i></div><div class="share-plat-name">More...</div></button>
        </div>
    </div>
    <div class="share-qr-section share-tab-content" data-content="qr"><img id="shareQr" class="share-qr-canvas" src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://amrelharony.com&color=00e1ff&bgcolor=ffffff&margin=10" alt="QR Code" width="200" height="200" style="border-radius:12px;border:1px solid var(--border);display:block;margin:0 auto;background:#fff"><div class="share-qr-label">Scan to visit amrelharony.com</div></div>
    <div class="share-card-section share-tab-content" data-content="card">
        <div class="share-dl-grid">
            <button class="share-dl-btn primary" onclick="downloadShareCard()"><i class="fa-solid fa-image"></i> Save as PNG</button>
            <button class="share-dl-btn" onclick="copyShareImage()"><i class="fa-solid fa-copy"></i> Copy Image</button>
        </div>
    </div>
    <div class="share-close" onclick="closeShare()">[ TAP OR ESC TO CLOSE ]</div>
</div></div>

<!-- Terminal Overlay -->
<div id="termOverlay" onclick="if(event.target===this)closeTerm()"><div class="term-win"><div class="term-bar"><span class="term-dot r" onclick="closeTerm()"></span><span class="term-dot y"></span><span class="term-dot g"></span><span class="term-title">amr@portfolio:~</span></div><div class="term-body" id="termBody"><div class="term-line"><span class="term-green">Welcome to Amr's Terminal v2.0</span></div><div class="term-line"><span class="term-out">Type <span class="term-accent">help</span> for available commands</span></div></div><div class="term-input-line"><span class="term-prompt">❯</span><input class="term-input" id="termInput" type="text" autocomplete="off" spellcheck="false" placeholder="type a command..."></div></div></div>
<!-- Mini Game Overlay -->
<div id="gameOverlay" onclick="if(event.target===this)closeGame()"><div class="game-win">
    <div class="game-hud">
        <div class="game-hud-item"><div class="game-hud-val" id="hudPortfolio">$0</div><div class="game-hud-label">Portfolio</div></div>
        <div class="game-hud-item"><div class="game-hud-val" id="hudLevel">1</div><div class="game-hud-label">Quarter</div></div>
        <div class="game-hud-item"><div class="game-hud-val profit" id="hudPnl">+$0</div><div class="game-hud-label">P&L</div></div>
        <div class="game-hud-item"><div class="game-hud-val" id="hudStreak">0</div><div class="game-hud-label">Streak</div></div>
    </div>
    <div class="game-ticker"><span id="gameTicker">Loading market data...</span></div>
    <div class="game-canvas-wrap"><canvas id="snakeCanvas" class="game-canvas" width="280" height="280"></canvas></div>
    <div class="game-level-bar"><span class="game-level-text" id="levelText">Q1</span><div class="game-level-track"><div class="game-level-fill" id="levelFill" style="width:0%"></div></div></div>
    <div class="game-msg" id="gameMsg">Collect 💰 coins to grow your portfolio</div>
    <div class="game-hint">Arrow keys · R restart · ESC close</div>
    <div id="gameTouchHint" style="font-family:'JetBrains Mono',monospace;font-size:10px;color:#58a6ff;padding:8px 14px;text-align:center;opacity:1;transition:opacity 1s">👆 Swipe anywhere to move</div>
    <div class="game-btns"><button class="game-btn" onclick="restartSnake()">↻ New Trade</button><button class="game-btn" onclick="closeGame()">✕ Close</button></div>
</div></div>
<!-- Keyboard Shortcuts Overlay -->
<div id="shortcutOverlay" onclick="if(event.target===this)closeShortcuts()"><div class="shortcut-panel"><div class="sc-title">⌨️ Keyboard Shortcuts</div><div class="sc-row"><span class="sc-key">T</span><span class="sc-desc">Open Trophy Case</span></div><div class="sc-row"><span class="sc-key">?</span><span class="sc-desc">This panel</span></div><div class="sc-row"><span class="sc-key">`</span><span class="sc-desc">Open Terminal</span></div><div class="sc-row"><span class="sc-key">G</span><span class="sc-desc">Play Snake</span></div><div class="sc-row"><span class="sc-key">↑↑↓↓←→←→BA</span><span class="sc-desc">Easter Egg</span></div><div class="sc-row"><span class="sc-key">Ctrl+P</span><span class="sc-desc">Print Resume</span></div><div class="sc-row"><span class="sc-key">ESC</span><span class="sc-desc">Close any overlay</span></div><div class="sc-close" onclick="closeShortcuts()">[ PRESS ? OR ESC TO CLOSE ]</div></div></div>
<!-- Trophy Case Overlay -->
<div id="trophyOverlay" onclick="if(event.target===this)closeTrophy()"><div class="trophy-panel"><div class="trophy-header"><div class="trophy-title">🏆 Trophy Case</div><div class="trophy-ring-wrap"><svg class="trophy-ring-svg" width="100" height="100" viewBox="0 0 100 100"><defs><linearGradient id="trophyGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="var(--accent)"/><stop offset="50%" stop-color="var(--accent2)"/><stop offset="100%" stop-color="var(--accent3)"/></linearGradient></defs><circle class="trophy-ring-bg" cx="50" cy="50" r="44"/><circle class="trophy-ring-fill" id="trophyRing" cx="50" cy="50" r="44" stroke-dasharray="276.5" stroke-dashoffset="276.5"/></svg><div class="trophy-ring-text"><div class="trophy-ring-pct" id="trophyPct">0%</div><div class="trophy-ring-sub">Complete</div></div></div><div class="trophy-stats"><div class="trophy-stat"><div class="trophy-stat-num" id="trophySBadges">0</div><div class="trophy-stat-label">Badges</div></div><div class="trophy-stat"><div class="trophy-stat-num" id="trophySXp">0</div><div class="trophy-stat-label">Total XP</div></div><div class="trophy-stat"><div class="trophy-stat-num" id="trophySLevel">1</div><div class="trophy-stat-label">Level</div></div></div><div class="trophy-xp-bar"><div class="trophy-xp-fill" id="trophyXpFill" style="width:0%"></div></div><div class="trophy-level" id="trophyLevel">Level 1 · 0 XP to next</div></div><div id="trophyGrid"></div><button class="trophy-share-btn" onclick="shareTrophy()"><i class="fa-solid fa-share" style="margin-right:4px"></i>Share Progress</button><div class="trophy-close" onclick="closeTrophy()">[ PRESS T OR TAP TO CLOSE ]</div></div></div>
<!-- Toast Notifications -->
<div class="toast-container" id="toastContainer"></div>
<div class="combo-indicator" id="comboIndicator"><div class="combo-count" id="comboCount">x2</div><div class="combo-label">combo</div><div class="combo-mult" id="comboMult">2× XP</div></div>
<!-- Smart CTA -->
<div class="smart-cta" id="smartCta"><a class="smart-cta-inner" id="smartCtaLink" href="#" target="_blank" rel="noopener"><div class="smart-cta-icon" id="smartCtaIcon"><i class="fa-solid fa-comments"></i></div><div class="smart-cta-text"><div class="smart-cta-title" id="smartCtaTitle"></div><div class="smart-cta-sub" id="smartCtaSub"></div></div><div class="smart-cta-close" onclick="event.preventDefault();event.stopPropagation();dismissSmartCta()"><i class="fa-solid fa-xmark"></i></div></a></div>

<div id="preloader" role="status" aria-label="Loading">
    <div class="pre-line" id="preLine">ESTABLISHING CONNECTION</div>
    <div class="pre-ctr" id="preCtr">0</div>
    <div class="pre-bar" id="preBar"><div class="pre-fill" id="preFill"></div></div>
    <div class="pre-stage" id="preStg"></div>
</div>

<div id="app">
    <div class="rv" style="display:flex;justify-content:center;">
        <div class="st"><span class="sd" id="sdot" style="background:#22c55e;" aria-hidden="true"></span><span id="stxt">LOCATING...</span></div>
    </div>
    <div id="greetBar" style="display:none;text-align:center;margin-top:4px;">
        <span style="font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:1.5px;text-transform:uppercase;color:var(--accent);opacity:.7;" id="greetTxt"></span>
    </div>
    <div class="pf rv" id="pfw" role="button" tabindex="0" aria-label="Flip to show QR code" onclick="toggleFlip()" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleFlip();}">
        <svg viewBox="0 0 136 136" aria-hidden="true"><circle cx="68" cy="68" r="66" stroke="var(--accent)" opacity=".3"/><circle cx="68" cy="68" r="66" stroke="var(--accent2)" opacity=".2" stroke-dasharray="4 10" style="animation-direction:reverse;animation-duration:18s"/></svg>
        <div class="pfi"><div class="fc"><div class="fi" id="fc">
            <div class="ff"><img src="profile.jpg" alt="Amr Elharony" onerror="this.style.display='none';this.nextElementSibling.style.display='flex';"><div style="width:100%;height:100%;background:var(--bg2);display:none;align-items:center;justify-content:center;"><i class="fa-solid fa-user" style="font-size:36px;color:var(--sub);" aria-hidden="true"></i></div></div>
            <div class="fb"><img id="qri" src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=https://amrelharony.com&color=00e1ff&bgcolor=06080f" alt="QR code" style="width:80%;height:80%;object-fit:contain;"></div>
        </div></div></div>
        <div class="qb" aria-hidden="true"><i class="fa-solid fa-qrcode"></i></div>
    </div>
    <div class="ph rv">TAP PHOTO FOR QR</div>

    <h1 class="hn rv"><span class="ng" id="hname">Amr Elharony</span></h1>
    <p class="vp rv" id="vpText">I help <strong>banks and FinTech teams</strong> ship digital products faster through <strong>agile delivery, data-driven decisions</strong>, and bridging the gap between business and technology.</p>
    <div class="rl rv" id="rtags"><span class="rt" data-ar="قائد التسليم">Delivery Lead</span><span class="rt" data-ar="مُرشد">Mentor</span><span class="rt" data-ar="مؤلف ومتحدث فينتك">Fintech Author & Speaker</span></div>

    <div class="imp rv" aria-label="Key achievements">
        <div class="imp-item"><div class="imp-num" id="impNum1">12+</div><div class="imp-label" id="impL1">Years in Banking</div></div>
        <div class="imp-item"><div class="imp-num" id="impNum2">1,000+</div><div class="imp-label" id="impL2">Mentoring Mins</div></div>
        <div class="imp-item"><div class="imp-num" id="impNum3">9+</div><div class="imp-label" id="impL3">Panel Stages</div></div>
    </div>


    <div class="ticker-wrap rv" aria-label="Recommendations">
        <div class="ticker" id="ticker"></div>
    </div>

    <div class="conf-strip rv">
        <span class="conf-badge">Seamless North Africa</span>
        <span class="conf-badge">Africa FinTech Forum</span>
        <span class="conf-badge">DevOpsDays Cairo</span>
        <span class="conf-badge">Techne Summit</span>
        <span class="conf-badge">Banking & Fintech Summit</span>
        <span class="conf-badge">Egypt Career Summit</span>
        <span class="conf-badge">TechUp Women</span>
    </div>

    <div class="shake-hint" id="shakeHint"><i class="fa-solid fa-mobile-screen-button" aria-hidden="true" style="margin-right:4px;"></i> Met me in person? Shake your phone</div>
    <div class="shake-bar" id="shakeBar"><div class="shake-fill" id="shakeFill"></div></div>
    <div class="desk-hint" id="deskHint"><i class="fa-solid fa-keyboard" aria-hidden="true" style="margin-right:4px;"></i> Met me? Press <strong style="color:var(--accent);">S</strong> to save my contact</div>
    <div id="contactSecret">
        <div class="sr" id="srow">
            <a href="https://www.linkedin.com/in/amrmelharony" target="_blank" rel="noopener" class="si" data-c="#0077b5" aria-label="LinkedIn"><i class="fa-brands fa-linkedin" aria-hidden="true"></i></a>
            <a href="https://api.whatsapp.com/send?phone=201114260806" target="_blank" rel="noopener" class="si" data-c="#25d366" aria-label="WhatsApp"><i class="fa-brands fa-whatsapp" aria-hidden="true"></i></a>
            <a href="https://t.me/Amrmelharony" target="_blank" rel="noopener" class="si" data-c="#0088cc" aria-label="Telegram"><i class="fa-brands fa-telegram" aria-hidden="true"></i></a>
            <a href="mailto:a.elharony@gmail.com" class="si" data-c="#ea4335" aria-label="Email"><i class="fa-solid fa-envelope" aria-hidden="true"></i></a>
        </div>
        <button class="vcb" id="vcBtn" onclick="downloadVCard()"><div class="vcb-shim"></div><i class="fa-solid fa-address-card" aria-hidden="true"></i><span id="vcTxt">Save Contact</span></button>
    </div>

    <div style="display:flex;flex-direction:column;gap:12px;">
        <a href="https://bilingualexecutive.amrelharony.com/" target="_blank" rel="noopener" class="lk rv"><div class="ls"></div><div class="lm"></div><div class="li"><img src="be.png" alt="" onerror="this.style.display='none';this.nextElementSibling.style.display='block';"><i class="fa-solid fa-book fbi" style="color:var(--accent);" aria-hidden="true"></i></div><div class="lb"><div class="lt">The Bilingual Executive</div><div class="lsu">My Book</div></div><div class="la" aria-hidden="true"><i class="fa-solid fa-arrow-right"></i></div></a>
        <a href="https://www.linkedin.com/company/fintech-bilinguals" target="_blank" rel="noopener" class="lk rv"><div class="ls"></div><div class="lm"></div><div class="li"><img src="fb.png" alt="" onerror="this.style.display='none';this.nextElementSibling.style.display='block';"><i class="fa-solid fa-users fbi" style="color:var(--accent2);" aria-hidden="true"></i></div><div class="lb"><div class="lt">Fintech Bilinguals</div><div class="lsu">Join the Community</div></div><div class="la" aria-hidden="true"><i class="fa-solid fa-arrow-right"></i></div></a>
        <a href="https://adplist.org/mentors/amr-elharony" target="_blank" rel="noopener" class="lk rv"><div class="ls"></div><div class="lm"></div><div class="li"><img src="smiley.jpg" style="border-radius:8px;" alt="" onerror="this.style.display='none';this.nextElementSibling.style.display='block';"><i class="fa-solid fa-graduation-cap fbi" style="color:var(--accent3);" aria-hidden="true"></i></div><div class="lb"><div class="lt">Get Mentored</div><div class="lsu">Free 1:1 Agile Coaching</div></div><div class="la" aria-hidden="true"><i class="fa-solid fa-arrow-right"></i></div></a>
    </div>

    <div class="nd rv"><div class="ndl"></div><div class="ndt">THE JOURNEY</div><div class="ndl"></div></div>
    <div class="tl-wrap rv"><div class="tl-line"></div>
        <div class="tl-item tl-era"><div class="tl-dot" style="border-color:var(--accent);"></div><div class="tl-yr">2026</div><div class="tl-txt"><strong>Author, Founder & Data Leader</strong></div></div>
        <div class="tl-item tl-sub"><div class="tl-dot"></div><div class="tl-txt">Data & Agile Leader — Navigating data delivery as a Scrum Master at Banque Misr</div></div>
        <div class="tl-item tl-sub"><div class="tl-dot"></div><div class="tl-txt">Published <strong>"The Bilingual Executive"</strong> (print, ebook & audiobook), launched at the Greek Campus</div></div>
        <div class="tl-item tl-sub"><div class="tl-dot"></div><div class="tl-txt">Founded <strong>"Fintech Bilinguals"</strong> community in Cairo</div></div>
        <div class="tl-item tl-sub"><div class="tl-dot"></div><div class="tl-txt">Certified Data Management Professional (CDMP)</div></div>

        <div class="tl-item tl-era"><div class="tl-dot" style="border-color:var(--accent2);"></div><div class="tl-yr">2025</div><div class="tl-txt"><strong>Agile Mastery & Industry Voice</strong></div></div>
        <div class="tl-item tl-sub"><div class="tl-dot"></div><div class="tl-txt">Championed hybrid Scrum/Kanban framework for data analytics at Banque Misr</div></div>
        <div class="tl-item tl-sub"><div class="tl-dot"></div><div class="tl-txt">Earned <strong>SAFe® 6 SM, PSM II, PSPO II, PSK I, PMI-ACP, ICAgile-ATF</strong>, Jira Cloud Management</div></div>
        <div class="tl-item tl-sub"><div class="tl-dot"></div><div class="tl-txt">Panels & keynotes at <strong>Techne Summit, DevOpsDays Cairo, Africa FinTech Forum</strong></div></div>

        <div class="tl-item tl-era"><div class="tl-dot" style="border-color:var(--accent3);"></div><div class="tl-yr">2023–24</div><div class="tl-txt"><strong>Doctorate & The Data Pivot</strong></div></div>
        <div class="tl-item tl-sub"><div class="tl-dot"></div><div class="tl-txt">Earned <strong>Doctorate (DBA)</strong> in Digital Transformation — Helwan University</div></div>
        <div class="tl-item tl-sub"><div class="tl-dot"></div><div class="tl-txt">Pivoted to Corporate Banking Data Analyst at Banque Misr + Datacamp Pro certification</div></div>
        <div class="tl-item tl-sub"><div class="tl-dot"></div><div class="tl-txt"><strong>2,240+ coaching minutes</strong> as ADPList Top Mentor · Won Banque Misr "Best Learner Award"</div></div>

        <div class="tl-item tl-era"><div class="tl-dot" style="border-color:#eab308;"></div><div class="tl-yr">2019–22</div><div class="tl-txt"><strong>Project Management & FinTech Foundations</strong></div></div>
        <div class="tl-item tl-sub"><div class="tl-dot"></div><div class="tl-txt">Managed complex banking projects at Banque Misr · Earned <strong>PMP</strong> (Sep 2022)</div></div>
        <div class="tl-item tl-sub"><div class="tl-dot"></div><div class="tl-txt">Certified Expert in Digital Finance — Frankfurt School of Finance & Management</div></div>
        <div class="tl-item tl-sub"><div class="tl-dot"></div><div class="tl-txt"><strong>MBA in Entrepreneurship</strong> (2019) · Pro bono consulting for Egyptian FinTech Association</div></div>

        <div class="tl-item tl-era"><div class="tl-dot" style="border-color:#22c55e;"></div><div class="tl-yr">2014–16</div><div class="tl-txt"><strong>Security & Economic Roots</strong></div></div>
        <div class="tl-item tl-sub"><div class="tl-dot"></div><div class="tl-txt">IT Officer — Egyptian Armed Forces, commanding digital security operations (2015–2016)</div></div>
        <div class="tl-item tl-sub"><div class="tl-dot"></div><div class="tl-txt"><strong>BA in International Economics</strong> — Helwan University (2014) · Internships at Central Bank of Egypt, EGX, Nissan</div></div>
    </div>

    <!-- Certification Wall -->
    <div class="nd rv"><div class="ndl"></div><div class="ndt">CERTIFICATIONS</div><div class="ndl"></div></div>
    <div class="cert-grid" id="certGrid">
        <a href="https://www.credly.com/badges/eec32200-0842-43d7-8ba5-336367850fd3" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">🎯</div><div class="cert-name"><strong>PMP</strong>Project Management</div><div class="cert-org">PMI · 2022</div></a>
        <a href="https://www.credly.com/badges/5d2548d0-8425-4d55-8ed6-d0f32095c1c8" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">🔄</div><div class="cert-name"><strong>SAFe® 6 SM</strong>Scrum Master</div><div class="cert-org">Scaled Agile · 2025</div></a>
        <a href="https://www.credly.com/badges/72258978-34b5-498b-b79b-d5c1f1bf26fe" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">📋</div><div class="cert-name"><strong>PSM II</strong>Pro Scrum Master</div><div class="cert-org">Scrum.org · 2025</div></a>
        <a href="https://www.credly.com/badges/beca0beb-d17d-4856-80ff-9fb770aa3478" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">📦</div><div class="cert-name"><strong>PSPO II</strong>Product Owner</div><div class="cert-org">Scrum.org · 2025</div></a>
        <a href="https://www.credly.com/badges/ffebe8e4-ee4f-44bc-b8c2-b91659b128e7" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">📊</div><div class="cert-name"><strong>PMI-ACP</strong>Agile Certified</div><div class="cert-org">PMI · 2025</div></a>
        <a href="https://www.credly.com/badges/c8e9e735-7e32-4947-baec-3df79627af6e" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">🧠</div><div class="cert-name"><strong>PSK I</strong>Scrum + Kanban</div><div class="cert-org">Scrum.org · 2025</div></a>
        <a href="https://www.credly.com/badges/a7f59e05-13a7-4de2-aa0a-577d2d3be6e6" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">🏗️</div><div class="cert-name"><strong>ICAgile ATF</strong>Agile Team Facilit.</div><div class="cert-org">ICAgile · 2025</div></a>
        <a href="https://certificates.cdmp.info/3bb25e30-c242-47b5-a3ae-d972fb8b7ee1" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">💾</div><div class="cert-name"><strong>CDMP</strong>Data Management</div><div class="cert-org">DAMA · 2026</div></a>
        <a href="https://media.licdn.com/dms/image/v2/D4D2DAQFo34ujncSchA/profile-treasury-image-shrink_1280_1280/B4DZkf0AldGgAQ-/0/1757175352139?e=1771588800&v=beta&t=bE9j3hyEb9F6y4xxgSCJfvoXb02-vsVnCuVSJLB1jKM" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">🏦</div><div class="cert-name"><strong>CEDF</strong>Digital Finance</div><div class="cert-org">Frankfurt School · 2019</div></a>
        <a href="https://www.datacamp.com/certificate/DA0026927366011" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">📈</div><div class="cert-name"><strong>Datacamp Pro</strong>Data Analyst</div><div class="cert-org">Datacamp · 2023</div></a>
        <a href="https://cp.certmetrics.com/atlassian/en/public/badge/c?id=5ecee96d9286180c30565dce&ccat=30&date=2025-11-2" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">⚙️</div><div class="cert-name"><strong>Jira Cloud</strong>Management</div><div class="cert-org">Atlassian · 2025</div></a>
        <a href="https://media.licdn.com/dms/image/v2/D4D2DAQEplmYsSyDekg/profile-treasury-image-shrink_1280_1280/profile-treasury-image-shrink_1280_1280/0/1707366993200?e=1771567200&v=beta&t=CKwIiV2jOhNbZOzQxxibKT58VhWqSDhrUl_J18hLW1w" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">🎓</div><div class="cert-name"><strong>DBA</strong>Digital Transform.</div><div class="cert-org">Helwan Univ. · 2023</div></a>
        <a href="https://media.licdn.com/dms/image/v2/D4D2DAQHpNVAsYWv22g/profile-treasury-image-shrink_1920_1920/B4DZkc7BZfJMAc-/0/1757126860063?e=1771567200&v=beta&t=-niS92ivnjqqsZAogiAfaZYYm5OlBU8VD0-cHxxjN_E" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">💼</div><div class="cert-name"><strong>MBA</strong>Entrepreneurship</div><div class="cert-org">2019</div></a>
        <a href="https://media.licdn.com/dms/image/v2/D4D2DAQG5xCkTacfhLQ/profile-treasury-image-shrink_8192_8192/B4DZkc7Fu7JkAg-/0/1757126876953?e=1771567200&v=beta&t=xHLa4tEySsC3q8VD2yGSZrEnYlYx91uSTY9oSjpO0MU" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">🌍</div><div class="cert-name"><strong>BA</strong>Intl. Economics</div><div class="cert-org">Helwan Univ. · 2014</div></a>
        <a href="https://media.licdn.com/dms/image/v2/D4D2DAQHGNYYaz1Xd8w/profile-treasury-image-shrink_800_800/profile-treasury-image-shrink_800_800/0/1720814197947?e=1771567200&v=beta&t=Z_HSYrZmDobUqWjbwnpPHKcpMUoXINyi3_jseIYffCg" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">📊</div><div class="cert-name"><strong>Investor Relations</strong>Program</div><div class="cert-org">FRA · May 2014</div></a>
        <a href="https://media.licdn.com/dms/image/v2/D4D2DAQGl168j8JlXZw/profile-treasury-image-shrink_800_800/profile-treasury-image-shrink_800_800/0/1732801386452?e=1771567200&v=beta&t=leX2wo2S2sKdeuoHDoIGaC4oaydAfhfyytjhkqCua2k" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">💡</div><div class="cert-name"><strong>Innovation</strong>Program</div><div class="cert-org">AMIDEAST · Jul 2024</div></a>
        <a href="https://media.licdn.com/dms/image/v2/D4D2DAQFQTB2JPwAEug/profile-treasury-image-shrink_1920_1920/profile-treasury-image-shrink_1920_1920/0/1720813462120?e=1771567200&v=beta&t=KsoAIvrnF_QF4hJ2jruggZDWuXsrv0dWpWkZ41WBshk" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">🌐</div><div class="cert-name"><strong>Best Practices</strong>Intl. Markets</div><div class="cert-org">Feb 2021</div></a>
        <a href="https://media.licdn.com/dms/image/v2/D4D2DAQEigBO4i79udQ/profile-treasury-image-shrink_800_800/profile-treasury-image-shrink_800_800/0/1720811624146?e=1771567200&v=beta&t=2XhQWthV7TE2cMTPIs7T3StCbhKUvE0li5OU2I8_t6Y" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">🏛️</div><div class="cert-name"><strong>Treasury Ops</strong>Bank Operations</div><div class="cert-org">Apr 2013</div></a>
        <a href="https://media.licdn.com/dms/image/v2/D4D2DAQGcQlWEOQDjRw/profile-treasury-image-shrink_800_800/profile-treasury-image-shrink_800_800/0/1720811283777?e=1771567200&v=beta&t=nDInMNd55VmAQsUmGUIbJIc_tb2xQlUPE2zi-aVEhn0" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">💳</div><div class="cert-name"><strong>Credit</strong>Course</div><div class="cert-org">Feb 2018</div></a>
        <a href="https://media.licdn.com/dms/image/v2/D4D2DAQGw_hIYiwgBcg/profile-treasury-image-shrink_800_800/profile-treasury-image-shrink_800_800/0/1720811075996?e=1771567200&v=beta&t=3DE_58yZYBjVu-oCNt17UIV8opMLV4-xKg5TTedyBEI" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">🌿</div><div class="cert-name"><strong>Green Finance</strong>EBRD Academy</div><div class="cert-org">Dec 2013</div></a>
        <a href="https://media.licdn.com/dms/image/v2/D4D2DAQHm6b8P2iP3dQ/profile-treasury-image-shrink_8192_8192/profile-treasury-image-shrink_8192_8192/0/1720811010808?e=1771567200&v=beta&t=OaKo0HvgLLdvLWm7F93v5f2PBYBnLUqebNofdThXnZk" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">🎤</div><div class="cert-name"><strong>Prof. Trainer</strong>Certified</div><div class="cert-org">Aug 2023</div></a>
        <a href="https://media.licdn.com/dms/image/v2/D4D2DAQGejtEQL5-A8w/profile-treasury-image-shrink_800_800/profile-treasury-image-shrink_800_800/0/1720616932797?e=1771567200&v=beta&t=u-9U8imn3xD_4j6ghN0ecTs0-5H58Vz1Hg-Imo8fvtE" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">📐</div><div class="cert-name"><strong>SME Consultant</strong>Accredited</div><div class="cert-org">Jun 2018</div></a>
        <a href="https://media.licdn.com/dms/image/v2/D4D2DAQGvesUaGim01A/profile-treasury-image-shrink_800_800/profile-treasury-image-shrink_800_800/0/1720614658079?e=1771567200&v=beta&t=EGLCujcqfu56bkAleU5X-6wRngm73qT0bSaG_41Bms8" target="_blank" rel="noopener" class="cert-card sa sa-scale"><div class="cert-verify"><i class="fa-solid fa-check"></i></div><div class="cert-icon">📉</div><div class="cert-name"><strong>Data Analysis</strong>Professional</div><div class="cert-org">Feb 2023</div></a>
    </div>

    <!-- Testimonial Carousel -->
    <div class="nd rv"><div class="ndl"></div><div class="ndt">WHAT 80+ PEOPLE SAY</div><div class="ndl"></div></div>
    <div class="tc-section">
        <div class="tc-cats" id="tcCats"></div>
        <div class="tc-viewport" id="tcViewport">
            <div class="tc-track" id="tcTrack"></div>
        </div>
        <div class="tc-nav">
            <button class="tc-arrow" id="tcPrev" aria-label="Previous"><i class="fa-solid fa-chevron-left"></i></button>
            <div class="tc-dots" id="tcDots"></div>
            <button class="tc-arrow" id="tcNext" aria-label="Next"><i class="fa-solid fa-chevron-right"></i></button>
        </div>
        <div class="tc-counter" id="tcCounter"></div>
        <div class="tc-auto-bar"><div class="tc-auto-fill" id="tcAutoFill"></div></div>
    </div>

    <!-- Print-only resume header -->
    <div class="print-only" style="text-align:center;margin-bottom:20px;padding-bottom:16px;border-bottom:2px solid #000;">
        <h1 style="font-size:28px;margin-bottom:4px;">Amr Elharony</h1>
        <p style="font-size:14px;color:#555;">Delivery Lead · Mentor · Fintech Author & Speaker</p>
        <p style="font-size:11px;color:#888;">Cairo, Egypt · a.elharony@gmail.com · amrelharony.com · linkedin.com/in/amrmelharony</p>
    </div>

    <div class="nd rv"><div class="ndl"></div><div class="ndt">LATEST ARTICLES</div><div class="ndl"></div></div>
    <div id="linkedinFeed" style="display:flex;flex-direction:column;gap:8px;margin-bottom:16px;">
        <div class="nl rv" style="opacity:.3;pointer-events:none;">
            <div class="ni"><i class="fa-solid fa-spinner fa-spin" style="color:var(--accent);"></i></div>
            <span class="nlb">Loading latest posts...</span>
        </div>
    </div>

    <!-- Personalized Recommendation -->
    <div id="recContainer" style="margin-bottom:16px;"></div>

    <button class="vcb rv" style="background:var(--card);color:var(--text);border:1px solid var(--border);margin-bottom:24px;" onclick="openShare()"><i class="fa-solid fa-share-nodes" aria-hidden="true"></i><span>Share My Profile</span></button>

    <div class="visitor-count" id="visitorCount"></div>
    <div class="streak" id="streakCount"></div>
    <div class="xp-footer" id="xpFooter" onclick="openTrophy()"><span class="xp-text" id="xpText">0 XP</span><div class="xp-bar-mini"><div class="xp-bar-fill" id="xpBarFill" style="width:0%"></div></div><span class="xp-level-badge" id="xpLevel" style="color:var(--accent);background:rgba(0,225,255,.1);">LVL 1</span></div>
    <div class="live-console" id="liveConsole"><span class="cursor-blink">▊</span></div>
    <div class="foot">&copy; <span id="yr"></span> Amr Elharony</div>
</div>

<script>
(()=>{
'use strict';
document.getElementById('yr').textContent=new Date().getFullYear();
const D=window.matchMedia('(pointer:fine)').matches;
const reducedMotion=window.matchMedia('(prefers-reduced-motion:reduce)').matches;
const isRepeatVisit=!!localStorage.getItem('visited');localStorage.setItem('visited','1');
const isMobile=window.matchMedia('(pointer:coarse)').matches;
const params=new URLSearchParams(location.search);

// ═══ SMART GREETING (referrer detection) ═══
const refMap={linkedin:'WELCOME FROM LINKEDIN',calendly:'EXCITED FOR OUR CALL',seamless:'GREAT SEEING YOU AT SEAMLESS',devopsdays:'HELLO FROM DEVOPSDAYS',techne:'WELCOME FROM TECHNE SUMMIT',afff:'HELLO FROM AFRICA FINTECH FORUM',career180:'WELCOME FROM CAREER SUMMIT',adplist:'WELCOME, FELLOW MENTOR'};
const refKey=params.get('ref');
let customGreeting=refKey&&refMap[refKey.toLowerCase()]?refMap[refKey.toLowerCase()]:null;

// ═══ SOCIAL PROOF TICKER ═══
const quotes=[
    {q:"A strategic catalyst for change... masterfully leverages technology to engineer fundamental shifts in systems and culture",a:"Ayman Hassan Soliman",r:"Senior Deputy GM"},
    {q:"Amr gets things done... delivering outstanding results on even the most complex and ambitious projects",a:"Omar Mohey",r:"Senior Data Steward"},
    {q:"Outstanding Scrum Master... organized, supportive, and excellent at guiding the team to achieve sprint goals",a:"Esmail Eldally",r:"Data Analyst"},
    {q:"The rare talent who sees the future of our data landscape, and then challenges, coaches, and leads his team to drive that change",a:"Alaa Ghaly",r:"Assistant Manager"},
    {q:"Wide knowledge in multidisciplinary topics, almost like a Wikipedia moving on Earth!",a:"Mohamed Abaza",r:"Lead Data Scientist"},
    {q:"Demonstrates remarkable courage in challenging the status quo... catalyzing fundamental shifts in both systems and attitude",a:"Romany Youssef",r:"GTB MIS Manager"},
    {q:"Provided exceptional motivation and problem-solving strategies... guidance that exceeds expectations",a:"Ahmed Shewail",r:"Senior Banker"},
    {q:"EQ is off the charts... a knack for improving morale and productivity just by being himself",a:"Walid Gafeer",r:"Senior RM"},
    {q:"Working with him was transformative. His deep tech expertise and talent for fintech set him apart",a:"Eslam Youssef",r:"Senior Data Analyst"},
    {q:"The complete package — a blend of business acumen and technology skills every organization needs",a:"Dina Tony",r:"Senior Corporate RM"}
];
function buildTicker(){
    const t=document.getElementById('ticker');
    const html=quotes.map(q=>`<div class="tq">"${q.q}" — <strong>${q.a}</strong>, ${q.r}</div>`).join('');
    t.innerHTML=html+html; // duplicate for seamless loop
}
buildTicker();

// ═══ PARTICLES ═══
const cv=document.getElementById('bgC'),cx=cv.getContext('2d');
let W,H,pts=[],mouse={x:-9999,y:-9999},gy={x:0,y:0};
const PC=D?90:45,CD=140,MR=200;let pC={r:0,g:225,b:255};
class Pt{constructor(){this.x=Math.random()*W;this.y=Math.random()*H;this.vx=(Math.random()-.5)*.4;this.vy=(Math.random()-.5)*.4;this.r=Math.random()*1.2+.4;this.ph=Math.random()*6.28;}
update(){this.ph+=.015;this.cr=this.r+Math.sin(this.ph)*.25;this.x+=this.vx+gy.x*.04;this.y+=this.vy+gy.y*.04;if(this.x<-10)this.x=W+10;if(this.x>W+10)this.x=-10;if(this.y<-10)this.y=H+10;if(this.y>H+10)this.y=-10;const dx=mouse.x-this.x,dy=mouse.y-this.y,d=Math.sqrt(dx*dx+dy*dy);if(d<MR&&d>0){const f=(MR-d)/MR;this.x-=(dx/d)*f*2.5;this.y-=(dy/d)*f*2.5;}}
draw(){const{r,g,b}=pC;cx.beginPath();cx.arc(this.x,this.y,this.cr,0,6.28);cx.fillStyle=`rgba(${r},${g},${b},.4)`;cx.fill();cx.beginPath();cx.arc(this.x,this.y,this.cr*3,0,6.28);cx.fillStyle=`rgba(${r},${g},${b},.04)`;cx.fill();}}
function initP(){pts=[];for(let i=0;i<PC;i++)pts.push(new Pt());}
function drawP(){cx.clearRect(0,0,W,H);const{r,g,b}=pC;for(let i=0;i<pts.length;i++){const a=pts[i];a.update();a.draw();for(let j=i+1;j<pts.length;j++){const bb=pts[j],dx=a.x-bb.x,dy=a.y-bb.y,dd=dx*dx+dy*dy;if(dd<CD*CD){const al=(1-Math.sqrt(dd)/CD)*.12;cx.beginPath();cx.strokeStyle=`rgba(${r},${g},${b},${al})`;cx.lineWidth=.5;cx.moveTo(a.x,a.y);cx.lineTo(bb.x,bb.y);cx.stroke();}}}requestAnimationFrame(drawP);}
function rsz(){W=cv.width=innerWidth;H=cv.height=innerHeight;if(!pts.length)initP();}
addEventListener('resize',rsz);rsz();
if(reducedMotion){}else if('requestIdleCallback' in window){requestIdleCallback(()=>{initP();drawP();});}else{setTimeout(()=>{initP();drawP();},100);}
addEventListener('mousemove',e=>{mouse.x=e.clientX;mouse.y=e.clientY;});
addEventListener('touchmove',e=>{if(e.touches[0]){mouse.x=e.touches[0].clientX;mouse.y=e.touches[0].clientY;}},{passive:true});
addEventListener('touchend',()=>{mouse.x=-9999;mouse.y=-9999;});
if(typeof DeviceOrientationEvent!=='undefined'){if(typeof DeviceOrientationEvent.requestPermission==='function'){document.body.addEventListener('touchstart',function g(){DeviceOrientationEvent.requestPermission().then(r=>{if(r==='granted')addEventListener('deviceorientation',oG);}).catch(()=>{});document.body.removeEventListener('touchstart',g);},{once:true});}else addEventListener('deviceorientation',oG);}
function oG(e){if(e.gamma!=null)gy.x=e.gamma;if(e.beta!=null)gy.y=e.beta;}

// ═══ CURSOR ═══
if(D&&!reducedMotion){const dot=document.getElementById('cdd'),glo=document.getElementById('cg');let gx=0,gy2=0;
document.addEventListener('mousemove',e=>{dot.style.left=e.clientX+'px';dot.style.top=e.clientY+'px';glo.classList.add('on');});
(function ag(){gx+=(mouse.x-gx)*.08;gy2+=(mouse.y-gy2)*.08;glo.style.left=gx+'px';glo.style.top=gy2+'px';requestAnimationFrame(ag);})();
const hs='a,button,.pf,.lk,.nl';document.addEventListener('mouseover',e=>{if(e.target.closest(hs))dot.classList.add('hov');});document.addEventListener('mouseout',e=>{if(e.target.closest(hs))dot.classList.remove('hov');});
document.querySelectorAll('.lk').forEach(card=>{const sp=card.querySelector('.ls');let cxx=0,cyy=0,tx=0,ty=0;
card.addEventListener('mousemove',e=>{const r=card.getBoundingClientRect(),x=e.clientX-r.left,y=e.clientY-r.top;if(sp)sp.style.background=`radial-gradient(250px circle at ${x}px ${y}px,var(--glow),transparent 70%)`;tx=((y-r.height/2)/(r.height/2))*-6;ty=((x-r.width/2)/(r.width/2))*6;});
card.addEventListener('mouseleave',()=>{tx=0;ty=0;});(function spr(){cxx+=(tx-cxx)*.12;cyy+=(ty-cyy)*.12;if(Math.abs(tx-cxx)>.01||Math.abs(ty-cyy)>.01||tx!==0)card.style.transform=`perspective(800px) rotateX(${cxx}deg) rotateY(${cyy}deg) scale3d(1.01,1.01,1.01)`;else card.style.transform='';requestAnimationFrame(spr);})();});}

// ═══ MOBILE TOOLBAR TOGGLE ═══
(function(){
    const tb=document.getElementById('topBtns');
    const tog=document.getElementById('tbToggle');
    if(!tb||!tog)return;
    let expanded=false;
    tog.addEventListener('click',function(e){
        e.stopPropagation();
        expanded=!expanded;
        tb.classList.toggle('expanded',expanded);
        tog.textContent=expanded?'✕':'⋮';
    });
    document.addEventListener('click',function(e){
        if(expanded&&!tb.contains(e.target)){
            expanded=false;tb.classList.remove('expanded');tog.textContent='⋮';
        }
    });
})();

// ═══ THEME ═══
function applyTheme(m){const i=document.getElementById('ticon'),l=m==='light';document.body.classList.toggle('light-mode',l);i.className=l?'fa-solid fa-moon':'fa-solid fa-sun';pC=l?{r:15,g:23,b:42}:{r:0,g:225,b:255};const q=document.getElementById('qri');if(q){const fg=l?'0066ff':'00e1ff',bg=l?'f4f6fb':'06080f';q.src=`https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=https://amrelharony.com&color=${fg}&bgcolor=${bg}`;}}
const sv=localStorage.getItem('theme'),hr=new Date().getHours();applyTheme(sv||(hr>=6&&hr<18?'light':'dark'));
document.getElementById('tbtn').addEventListener('click',()=>{const n=document.body.classList.contains('light-mode')?'dark':'light';localStorage.setItem('theme',n);applyTheme(n);});

// ═══ FLIP ═══
window.toggleFlip=()=>document.getElementById('fc').classList.toggle('flipped');

// ═══ STATUS (with smart greeting) ═══
function updStatus(){
    const now=new Date();
    const cairoOpts={timeZone:'Africa/Cairo'};
    const h=parseInt(now.toLocaleString('en-US',{...cairoOpts,hour:'numeric',hour12:false}));
    const dayName=now.toLocaleString('en-US',{...cairoOpts,weekday:'long'});
    const dot=document.getElementById('sdot'),txt=document.getElementById('stxt');
    let msg,col;

    // Check weekend (Egypt: Friday & Saturday)
    const isWeekend=(dayName==='Friday'||dayName==='Saturday');

    // Check if today is a holiday (loaded async, defaults to false)
    const isHoliday=window._cairoHolidayToday||false;
    const holidayName=window._cairoHolidayName||'';

    if(isHoliday){
        msg='CAIRO · 🎉 '+holidayName.toUpperCase();col='#eab308';
    } else if(isWeekend){
        msg=dayName==='Friday'?'CAIRO · 🕌 FRIDAY REST':'CAIRO · WEEKEND MODE';col='#f97316';
    } else if(h>=9&&h<17){
        msg='CAIRO · BUILDING FINTECH';col='#22c55e';
    } else if(h>=17&&h<23){
        msg='CAIRO · MENTORING';col='#a855f7';
    } else {
        msg='CAIRO · OFFLINE';col='#f97316';
    }

    dot.style.background=col;
    if(reducedMotion){txt.textContent=msg;return;}
    txt.textContent='';let i=0;(function t(){if(i<msg.length){txt.textContent+=msg[i];i++;setTimeout(t,35);}})();
    if(customGreeting){
        const bar=document.getElementById('greetBar');
        const gt=document.getElementById('greetTxt');
        if(bar&&gt){bar.style.display='block';gt.textContent=customGreeting;}
    }
}

// ═══ EGYPT HOLIDAYS (via Nager.Date free API) ═══
(async function(){
    try{
        const yr=new Date().getFullYear();
        const res=await fetch('https://date.nager.at/api/v3/PublicHolidays/'+yr+'/EG');
        if(res.ok){
            const holidays=await res.json();
            const today=new Date().toLocaleString('en-CA',{timeZone:'Africa/Cairo'}).split(',')[0];// YYYY-MM-DD
            const match=holidays.find(h=>h.date===today);
            if(match){
                window._cairoHolidayToday=true;
                window._cairoHolidayName=match.localName||match.name;
                updStatus();// Re-render with holiday
            }
        }
    }catch(e){}
})();

// ═══ CAIRO WEATHER (Open-Meteo free API, no key) ═══
(async function(){
    const CACHE_KEY='cairoWeather';const TTL=3600000;// 1 hour
    const weatherIcons={'0':'☀️','1':'🌤️','2':'⛅','3':'☁️','45':'🌫️','48':'🌫️','51':'🌦️','53':'🌧️','55':'🌧️','56':'🌨️','57':'🌨️','61':'🌧️','63':'🌧️','65':'🌧️','66':'🌨️','67':'🌨️','71':'🌨️','73':'🌨️','75':'❄️','77':'❄️','80':'🌦️','81':'🌧️','82':'⛈️','85':'🌨️','86':'🌨️','95':'⛈️','96':'⛈️','99':'⛈️'};

    function render(data){
        const w=document.getElementById('weatherWidget');
        const ico=document.getElementById('weatherIcon');
        const tmp=document.getElementById('weatherTemp');
        if(!w||!ico||!tmp)return;
        ico.textContent=weatherIcons[String(data.code)]||'🌡️';
        tmp.textContent=Math.round(data.temp)+'°C';
        w.classList.add('show');
    }

    function getCached(){
        try{const raw=localStorage.getItem(CACHE_KEY);if(!raw)return null;const{data,ts}=JSON.parse(raw);if(Date.now()-ts<TTL)return data;return null;}catch(e){return null;}
    }

    try{
        const cached=getCached();
        if(cached){render(cached);return;}
        // Cairo: 30.0444°N, 31.2357°E
        const res=await fetch('https://api.open-meteo.com/v1/forecast?latitude=30.0444&longitude=31.2357&current=temperature_2m,weather_code&timezone=Africa%2FCairo');
        if(res.ok){
            const json=await res.json();
            const data={temp:json.current.temperature_2m,code:json.current.weather_code};
            localStorage.setItem(CACHE_KEY,JSON.stringify({data,ts:Date.now()}));
            render(data);
        }
    }catch(e){}

    // Refresh every hour
    setInterval(async()=>{
        try{
            localStorage.removeItem(CACHE_KEY);
            const res=await fetch('https://api.open-meteo.com/v1/forecast?latitude=30.0444&longitude=31.2357&current=temperature_2m,weather_code&timezone=Africa%2FCairo');
            if(res.ok){const json=await res.json();const data={temp:json.current.temperature_2m,code:json.current.weather_code};localStorage.setItem(CACHE_KEY,JSON.stringify({data,ts:Date.now()}));render(data);}
        }catch(e){}
    },3600000);
})();

// ═══ LIVE MENTORING COUNTER ═══
// Base: 1000 mins as of Oct 2023. ~80 mins/month estimated growth.
function getMentoringMins(){const base=1000,startDate=new Date('2023-10-01'),now=new Date(),months=(now.getFullYear()-startDate.getFullYear())*12+(now.getMonth()-startDate.getMonth());return base+Math.floor(months*80);}
function animateCounter(el,target){if(reducedMotion){el.textContent=target.toLocaleString()+'+';return;}let curr=0;const dur=1500,step=Math.ceil(target/60);const iv=setInterval(()=>{curr=Math.min(curr+step,target);el.textContent=curr.toLocaleString()+'+';if(curr>=target)clearInterval(iv);},dur/60);}

// ═══ TEXT SCRAMBLE ═══
class Scr{constructor(el){this.el=el;this.ch='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';}
run(text){if(reducedMotion){this.el.innerHTML=`<span class="ng">${text}</span>`;return;}const q=[];for(let i=0;i<text.length;i++)q.push({to:text[i],start:Math.floor(Math.random()*15),end:Math.floor(Math.random()*15)+15+i*2,c:null});let f=0;const u=()=>{let o='',done=0;for(let i=0;i<q.length;i++){const x=q[i];if(f>=x.end){o+=x.to;done++;}else if(f>=x.start){if(!x.c||Math.random()<.3)x.c=this.ch[Math.floor(Math.random()*this.ch.length)];o+=`<span class="sg">${x.c}</span>`;}else o+='';}this.el.innerHTML=o;if(done<q.length){f++;requestAnimationFrame(u);}else this.el.innerHTML=`<span class="ng">${text}</span>`;};u();}}

// ═══ PRELOADER ═══
const stages=['RESOLVING DNS','ESTABLISHING TLS','LOADING MODULES','DECRYPTING PAYLOAD','RENDERING INTERFACE','READY'];
const SPEED=isRepeatVisit?8:4;
gsap.to('#preLine',{opacity:1,duration:.3,delay:.1});gsap.to('#preCtr',{opacity:1,duration:.3,delay:.2});gsap.to('#preBar',{opacity:1,duration:.3,delay:.3});gsap.to('#preStg',{opacity:1,duration:.3,delay:.35});
let prog=0;const li=setInterval(()=>{prog=Math.min(100,prog+Math.random()*SPEED+1.5);const p=Math.round(prog);document.getElementById('preCtr').textContent=p;document.getElementById('preFill').style.width=p+'%';document.getElementById('preStg').textContent=stages[Math.min(stages.length-1,Math.floor(p/100*stages.length))];if(p>=100){clearInterval(li);setTimeout(launch,isRepeatVisit?100:300);}},isRepeatVisit?20:30);

function done(el){el.classList.remove('rv');el.style.opacity='';el.style.transform='';gsap.set(el,{clearProps:'all'});el.style.opacity='1';el.style.transform='none';}
function launch(){
    const pre=document.getElementById('preloader'),app=document.getElementById('app');
    gsap.to('#preCtr',{scale:1.3,opacity:0,duration:.3,ease:'power2.in'});gsap.to(['#preLine','#preBar','#preStg'],{opacity:0,duration:.2});
    pre.style.clipPath='inset(0 0 0% 0)';gsap.to(pre,{clipPath:'inset(0 0 100% 0)',duration:.9,delay:.3,ease:'power4.inOut',onComplete:()=>{pre.style.display='none';document.body.style.overflow='auto';document.body.style.overflowX='hidden';}});
    gsap.to(app,{opacity:1,duration:.5,delay:.6});setTimeout(updStatus,800);
    document.querySelectorAll('.rv').forEach((el,i)=>{gsap.to(el,{opacity:1,y:0,duration:.9,delay:.8+i*.08,ease:'power3.out',onComplete:()=>done(el)});});
    setTimeout(()=>new Scr(document.getElementById('hname')).run(isArabic?'عمرو الحاروني':'Amr Elharony'),1400);
    document.querySelectorAll('.rt').forEach((t,i)=>{gsap.from(t,{scale:.7,opacity:0,y:10,duration:.5,delay:1.1+i*.1,ease:'back.out(2)',onComplete:()=>{gsap.set(t,{clearProps:'all'});t.style.opacity='1';}});});
    document.querySelectorAll('.lk').forEach((c,i)=>{gsap.fromTo(c,{opacity:0,y:50,scale:.92,rotateX:10,filter:'blur(6px)'},{opacity:1,y:0,scale:1,rotateX:0,filter:'blur(0px)',duration:.8,delay:1.4+i*.12,ease:'power3.out',onComplete:()=>done(c)});});
    document.querySelectorAll('.nl').forEach((c,i)=>{gsap.fromTo(c,{opacity:0,x:-20},{opacity:1,x:0,duration:.6,delay:2+i*.1,ease:'power2.out',onComplete:()=>done(c)});});
    // Animate mentoring counter
    setTimeout(()=>animateCounter(document.getElementById('impNum2'),getMentoringMins()),1200);
    // Timeline stagger
    document.querySelectorAll('.tl-item').forEach((t,i)=>{gsap.fromTo(t,{opacity:0,x:-15},{opacity:1,x:0,duration:.5,delay:2.2+i*.12,ease:'power2.out'});});
}

// ═══ PROXIMITY-GATED CONTACT ═══
let contactRevealed=false,isNearby=false;
function revealContact(){
    if(contactRevealed)return;contactRevealed=true;
    const secret=document.getElementById('contactSecret'),hint=document.getElementById('shakeHint'),deskHint=document.getElementById('deskHint'),bar=document.getElementById('shakeBar');
    secret.classList.add('revealed');if(hint){hint.classList.remove('shaking');hint.classList.add('unlocked');hint.innerHTML='<i class="fa-solid fa-lock-open" style="margin-right:4px;"></i> UNLOCKED';}if(bar)bar.classList.remove('active');
    secret.querySelectorAll('.si').forEach(el=>{const c=el.dataset.c;el.addEventListener('mouseenter',()=>el.style.color=c);el.addEventListener('mouseleave',()=>el.style.color='');});
    secret.querySelectorAll('.si').forEach((s,i)=>{gsap.from(s,{scale:0,rotation:90,duration:.5,delay:i*.08,ease:'back.out(3)',onComplete:()=>{gsap.set(s,{clearProps:'all'});s.style.opacity='1';}});});
    if(D&&!reducedMotion){secret.querySelectorAll('.si').forEach(el=>{el.addEventListener('mousemove',e=>{const r=el.getBoundingClientRect();el.style.transform=`translate(${(e.clientX-(r.left+r.width/2))*.35}px,${(e.clientY-(r.top+r.height/2))*.35}px)`;});el.addEventListener('mouseleave',()=>{el.style.transition='transform .5s cubic-bezier(.16,1,.3,1),color .3s';el.style.transform='';setTimeout(()=>el.style.transition='color .3s,transform .3s cubic-bezier(.16,1,.3,1)',.5e3);});});}
    if(navigator.vibrate)navigator.vibrate([100,50,100]);
    setTimeout(()=>{[hint,deskHint].forEach(h=>{if(h){h.style.opacity='0';setTimeout(()=>h.style.display='none',400);}});},3000);
}
function enableNearbyHints(){isNearby=true;if(isMobile){document.getElementById('shakeHint').style.display='block';initShake();}else{document.getElementById('deskHint').style.display='block';}}
if(params.has('s')){setTimeout(()=>revealContact(),3500);}else{
    const CAIRO_LAT=30.0444,CAIRO_LNG=31.2357,RADIUS_KM=25;
    function haversineKm(lat1,lon1,lat2,lon2){const R=6371,dLat=(lat2-lat1)*Math.PI/180,dLon=(lon2-lon1)*Math.PI/180;const a=Math.sin(dLat/2)**2+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));}
    fetch('https://ip-api.com/json/?fields=lat,lon,city,status',{mode:'cors'}).then(r=>r.json()).then(data=>{if(data.status==='success'){const dist=haversineKm(data.lat,data.lon,CAIRO_LAT,CAIRO_LNG);if(dist<=RADIUS_KM)enableNearbyHints();}}).catch(()=>{});
}
function initShake(){const SHAKE_THRESHOLD=15,SHAKE_DURATION=2000;let shakeStart=0,shaking=false;const hint=document.getElementById('shakeHint'),bar=document.getElementById('shakeBar'),fill=document.getElementById('shakeFill');
function handleMotion(e){if(contactRevealed)return;const acc=e.accelerationIncludingGravity;if(!acc)return;const total=Math.sqrt(acc.x*acc.x+acc.y*acc.y+acc.z*acc.z),accelNet=Math.abs(total-9.81);
if(accelNet>SHAKE_THRESHOLD){if(!shaking){shaking=true;shakeStart=Date.now();hint.classList.add('shaking');bar.classList.add('active');}const elapsed=Date.now()-shakeStart,progress=Math.min(elapsed/SHAKE_DURATION*100,100);fill.style.width=progress+'%';if(elapsed>=SHAKE_DURATION){window.removeEventListener('devicemotion',handleMotion);fill.style.width='100%';revealContact();}}else{if(shaking){shaking=false;shakeStart=0;hint.classList.remove('shaking');bar.classList.remove('active');fill.style.width='0%';}}}
if(typeof DeviceMotionEvent!=='undefined'&&typeof DeviceMotionEvent.requestPermission==='function'){document.body.addEventListener('touchstart',function rp(){DeviceMotionEvent.requestPermission().then(r=>{if(r==='granted')window.addEventListener('devicemotion',handleMotion);}).catch(()=>{});document.body.removeEventListener('touchstart',rp);},{once:true});}else if(typeof DeviceMotionEvent!=='undefined'){window.addEventListener('devicemotion',handleMotion);}}
document.addEventListener('keydown',e=>{if(isNearby&&e.key==='s'&&!e.ctrlKey&&!e.metaKey&&!e.altKey&&document.activeElement.tagName!=='INPUT')revealContact();});

// ═══ VCARD ═══
window.downloadVCard=function(){const vcard=['BEGIN:VCARD','VERSION:3.0','N:Elharony;Amr;;;','FN:Amr Elharony','TITLE:Delivery Lead | Mentor | Fintech Author & Speaker','ORG:Banque Misr','TEL;TYPE=CELL:+201114260806','EMAIL;TYPE=INTERNET:a.elharony@gmail.com','URL:https://amrelharony.com','URL:https://bilingualexecutive.amrelharony.com/','URL:https://www.linkedin.com/in/amrmelharony','X-SOCIALPROFILE;TYPE=linkedin:https://www.linkedin.com/in/amrmelharony','X-SOCIALPROFILE;TYPE=telegram:https://t.me/Amrmelharony','NOTE:Scrum Master at Banque Misr. Author of The Bilingual Executive. DBA in Digital Transformation.','END:VCARD'].join('\r\n');
const blob=new Blob([vcard],{type:'text/vcard;charset=utf-8'}),url=URL.createObjectURL(blob),a=document.createElement('a');a.href=url;a.download='Amr_Elharony.vcf';document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);
const btn=document.getElementById('vcBtn'),txt=document.getElementById('vcTxt'),icon=btn.querySelector('i');btn.classList.add('vcb-done');icon.className='fa-solid fa-check';txt.textContent='SAVED!';setTimeout(()=>{btn.classList.remove('vcb-done');icon.className='fa-solid fa-address-card';txt.textContent='Save Contact';},2500);};

// ═══ EASTER EGG (Konami Code + Double-tap logo) ═══
const konami=[38,38,40,40,37,39,37,39,66,65];let kIdx=0;
document.addEventListener('keydown',e=>{if(e.keyCode===konami[kIdx]){kIdx++;if(kIdx===konami.length){kIdx=0;showEgg();}}else{kIdx=0;}});
let lastTap=0;document.getElementById('pfw').addEventListener('touchend',e=>{const now=Date.now();if(now-lastTap<300){e.preventDefault();showEgg();}lastTap=now;});
function showEgg(){const el=document.getElementById('easterEgg');el.classList.add('show');if(navigator.vibrate)navigator.vibrate([50,30,50,30,100]);}
window.closeEgg=function(){document.getElementById('easterEgg').classList.remove('show');};
// Escape handled by unified handler below

// ═══ ARABIC/ENGLISH TOGGLE ═══
let isArabic=false;
// Language toggle removed — stub for compatibility
const _langEl=document.createElement('button');_langEl.id='langBtn';_langEl.style.display='none';document.body.appendChild(_langEl);

// ═══ VISITOR COUNTER ═══
(function(){
    // Uses countapi.xyz alternative — simple localStorage + estimation
    let count=parseInt(localStorage.getItem('vc')||'0')+1;
    // Add randomized base to make it feel real
    const base=4200+Math.floor(count*1.3);
    localStorage.setItem('vc',count.toString());
    document.getElementById('visitorCount').textContent=`Visitor #${base.toLocaleString()}`;
})();

// ═══ DYNAMIC WEATHER BACKGROUND ═══
(function(){
    fetch('https://wttr.in/Cairo?format=%C&m',{headers:{'Accept':'text/plain'}})
        .then(r=>r.text()).then(w=>{
            w=w.trim().toLowerCase();
            const mesh=document.querySelectorAll('.mesh div');
            if(w.includes('sun')||w.includes('clear')){
                mesh[0].style.background='#ff9500';mesh[1].style.background='#ff6b00';mesh[2].style.background='#ffcc00';
            }else if(w.includes('rain')||w.includes('drizzle')){
                mesh[0].style.background='#0077ff';mesh[1].style.background='#004499';mesh[2].style.background='#66aaff';
            }else if(w.includes('cloud')||w.includes('overcast')){
                mesh[0].style.background='#8899aa';mesh[1].style.background='#667788';mesh[2].style.background='#99aabb';
            }
            // night override
            const cairoH=parseInt(new Date().toLocaleString("en-US",{timeZone:"Africa/Cairo",hour:"numeric",hour12:false}));
            if(cairoH>=20||cairoH<5){mesh[0].style.background='#1a0a3e';mesh[1].style.background='#4a1a8a';mesh[2].style.background='#0a0a2e';}
        }).catch(()=>{});
})();

    
// ═══ SHARE CARD ═══
window.openShare=function(){
    const c=document.getElementById('shareCanvas'),ctx=c.getContext('2d');
    const l=document.body.classList.contains('light-mode');
    const W=600,H=340;
    c.width=W;c.height=H;

    // Background with gradient mesh
    ctx.fillStyle=l?'#f4f6fb':'#06080f';ctx.fillRect(0,0,W,H);
    // Mesh blobs
    const drawBlob=(x,y,r,color,alpha)=>{const g=ctx.createRadialGradient(x,y,0,x,y,r);g.addColorStop(0,color.replace(')',`,${alpha})`).replace('rgb','rgba'));g.addColorStop(1,'transparent');ctx.fillStyle=g;ctx.fillRect(x-r,y-r,r*2,r*2);};
    drawBlob(80,60,180,'rgb(0,225,255)',0.08);
    drawBlob(500,280,160,'rgb(99,102,241)',0.06);
    drawBlob(350,100,120,'rgb(168,85,247)',0.04);

    // Top accent bar gradient
    const grd=ctx.createLinearGradient(0,0,W,0);
    grd.addColorStop(0,'#00e1ff');grd.addColorStop(0.5,'#6366f1');grd.addColorStop(1,'#a855f7');
    ctx.fillStyle=grd;ctx.fillRect(0,0,W,4);

    // Name
    ctx.font='bold 34px Inter,sans-serif';ctx.fillStyle=l?'#0a0f1a':'#f0f2f5';
    ctx.fillText('Amr Elharony',40,72);

    // Title with accent
    ctx.font='13px JetBrains Mono,monospace';
    const titleGrd=ctx.createLinearGradient(40,0,400,0);
    titleGrd.addColorStop(0,'#00e1ff');titleGrd.addColorStop(1,'#6366f1');
    ctx.fillStyle=titleGrd;
    ctx.fillText('Delivery Lead · Mentor · Fintech Author & Speaker',40,100);

    // Divider line
    ctx.strokeStyle=l?'rgba(0,0,0,0.06)':'rgba(255,255,255,0.06)';
    ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(40,120);ctx.lineTo(W-40,120);ctx.stroke();

    // Stats row
    const stats=[
        {val:'20+',label:'CERTIFICATIONS',icon:'🎓'},
        {val:'80+',label:'RECOMMENDATIONS',icon:'⭐'},
        {val:getMentoringMins().toLocaleString()+'+',label:'MENTORING MINS',icon:'🗣️'},
        {val:'12+',label:'YEARS IN BANKING',icon:'🏦'}
    ];
    const statW=130;
    stats.forEach((s,i)=>{
        const x=40+i*statW;
        ctx.font='18px serif';ctx.fillText(s.icon,x,164);
        ctx.font='bold 22px JetBrains Mono,monospace';
        ctx.fillStyle='#00e1ff';ctx.fillText(s.val,x+24,166);
        ctx.font='7px JetBrains Mono,monospace';
        ctx.fillStyle=l?'#5a6578':'#4a5568';ctx.fillText(s.label,x,182);
        ctx.fillStyle=l?'#0a0f1a':'#f0f2f5';
    });

    // Testimonial snippet
    ctx.font='italic 11px Inter,sans-serif';
    ctx.fillStyle=l?'#5a6578':'#6b7a90';
    ctx.fillText('"A strategic catalyst for change... masterfully leverages technology"',40,220);
    ctx.font='9px JetBrains Mono,monospace';
    ctx.fillStyle=l?'#8a94a6':'#4a5568';
    ctx.fillText('— Ayman Hassan Soliman, Senior Deputy GM, Banque Misr',40,238);

    // Footer
    ctx.fillStyle=l?'rgba(0,0,0,0.03)':'rgba(255,255,255,0.02)';
    ctx.fillRect(0,H-50,W,50);
    ctx.strokeStyle=l?'rgba(0,0,0,0.06)':'rgba(255,255,255,0.04)';
    ctx.beginPath();ctx.moveTo(0,H-50);ctx.lineTo(W,H-50);ctx.stroke();

    ctx.font='11px JetBrains Mono,monospace';
    ctx.fillStyle='#00e1ff';ctx.fillText('amrelharony.com',40,H-20);

    ctx.font='9px JetBrains Mono,monospace';
    ctx.fillStyle=l?'#8a94a6':'#4a5568';
    ctx.fillText('linkedin.com/in/amrmelharony',W-220,H-20);

    document.getElementById('shareOverlay').classList.add('show');
};

window.closeShare=function(){document.getElementById('shareOverlay').classList.remove('show');};

// QR code now uses external API image — no canvas generation needed

// Tab switching
document.querySelectorAll('.share-tab').forEach(tab=>{
    tab.addEventListener('click',()=>{
        document.querySelectorAll('.share-tab').forEach(t=>t.classList.remove('active'));
        document.querySelectorAll('.share-tab-content').forEach(c=>{c.classList.remove('active');c.style.display='none';});
        tab.classList.add('active');
        const content=document.querySelector(`.share-tab-content[data-content="${tab.dataset.tab}"]`);
        if(content){content.classList.add('active');content.style.display=tab.dataset.tab==='platforms'?'block':tab.dataset.tab==='qr'?'block':'block';}
    });
});

// Platform sharing
const SHARE_URL='https://amrelharony.com';
const SHARE_TITLE='Amr Elharony — Delivery Lead · Mentor · Fintech Author';
const SHARE_TEXT='Check out Amr Elharony\'s portfolio — Delivery Lead, Mentor, and FinTech Author with 20+ certifications and 80+ recommendations.';

document.querySelectorAll('.share-plat').forEach(btn=>{
    btn.addEventListener('click',()=>{
        const p=btn.dataset.platform;
        const urls={
            linkedin:`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(SHARE_URL)}`,
            twitter:`https://twitter.com/intent/tweet?text=${encodeURIComponent(SHARE_TEXT)}&url=${encodeURIComponent(SHARE_URL)}`,
            whatsapp:`https://wa.me/?text=${encodeURIComponent(SHARE_TEXT+' '+SHARE_URL)}`,
            telegram:`https://t.me/share/url?url=${encodeURIComponent(SHARE_URL)}&text=${encodeURIComponent(SHARE_TEXT)}`,
            email:`mailto:?subject=${encodeURIComponent(SHARE_TITLE)}&body=${encodeURIComponent(SHARE_TEXT+'\n\n'+SHARE_URL)}`,
            facebook:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(SHARE_URL)}`
        };
        if(p==='copy'){
            navigator.clipboard.writeText(SHARE_URL).then(()=>{showCopied();});
        } else if(p==='native'){
            if(navigator.share)navigator.share({title:SHARE_TITLE,text:SHARE_TEXT,url:SHARE_URL}).catch(()=>{});
            else{navigator.clipboard.writeText(SHARE_URL).then(()=>{showCopied();});}
        } else if(urls[p]){
            window.open(urls[p],'_blank','noopener,width=600,height=500');
        }
        VDna.addXp(5);
    });
});

function showCopied(){
    const el=document.getElementById('shareCopied');
    el.classList.add('show');setTimeout(()=>el.classList.remove('show'),1500);
}

window.downloadShareCard=function(){
    const a=document.createElement('a');a.download='Amr_Elharony_Card.png';
    a.href=document.getElementById('shareCanvas').toDataURL('image/png');a.click();
};

window.copyShareImage=function(){
    document.getElementById('shareCanvas').toBlob(blob=>{
        if(blob&&navigator.clipboard&&navigator.clipboard.write){
            navigator.clipboard.write([new ClipboardItem({'image/png':blob})]).then(()=>showCopied()).catch(()=>{showCopied();});
        } else {showCopied();}
    },'image/png');
};
// Escape handled by unified handler

// ═══ STREAK ═══
(function(){const today=new Date().toDateString(),last=localStorage.getItem('lastVisit');let streak=parseInt(localStorage.getItem('streak')||'0');if(last!==today){const yd=new Date();yd.setDate(yd.getDate()-1);streak=(last===yd.toDateString())?streak+1:1;}localStorage.setItem('streak',streak.toString());localStorage.setItem('lastVisit',today);if(streak>1)document.getElementById('streakCount').textContent=`🔥 ${streak}-day visit streak`;})();

// ═══ LIVE LINKEDIN FEED ═══
(async function(){
    const container = document.getElementById('linkedinFeed');
    
    // 1. Go to rss.app, create a feed for your LinkedIn profile URL.
    // 2. Paste the generated RSS link below:
    const myRssUrl = 'https://rss.app/feeds/9LkeDk2rdq1NPifG.xml'; 
    
    const proxyUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(myRssUrl)}`;

    try {
        const res = await fetch(proxyUrl);
        const data = await res.json();
        
        if (data.status === 'ok' && data.items.length > 0) {
            container.innerHTML = data.items.slice(0, 5).map(post => `
                <a href="${post.link}" target="_blank" rel="noopener" class="nl rv" style="opacity:1; transform:none;">
                    <div class="ni"><i class="fa-brands fa-linkedin" style="color:#0077b5;" aria-hidden="true"></i></div>
                    <span class="nlb" style="display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;">
                        ${post.title || 'View my latest post on LinkedIn'}
                    </span>
                    <i class="fa-solid fa-external-link-alt ne" aria-hidden="true"></i>
                </a>
            `).join('');
        } else {
            container.innerHTML = `<span class="nlb" style="font-size:12px; opacity:0.5;">No recent posts found.</span>`;
        }
    } catch (err) {
        container.innerHTML = `<span class="nlb" style="font-size:12px; color:var(--accent3);">Feed temporarily unavailable.</span>`;
    }
})();

// ═════════════════════════════════════════════════
// SYSTEM 1: VISITOR INTELLIGENCE ENGINE
// ═════════════════════════════════════════════════
const VDna=(function(){
    const k='v_dna';let p=JSON.parse(localStorage.getItem(k)||'{}');
    // Build DNA on every visit
    p.visits=(p.visits||0)+1;
    p.firstVisit=p.firstVisit||Date.now();
    p.lastVisit=Date.now();
    p.device=D?'desktop':'mobile';
    p.os=navigator.userAgent.match(/Windows/)?"Windows":navigator.userAgent.match(/Mac/)?"Mac":navigator.userAgent.match(/Android/)?"Android":navigator.userAgent.match(/iPhone|iPad/)?"iOS":"Other";
    p.browser=navigator.userAgent.match(/Chrome/)?"Chrome":navigator.userAgent.match(/Firefox/)?"Firefox":navigator.userAgent.match(/Safari/)?"Safari":"Other";
    p.screen=`${screen.width}x${screen.height}`;
    p.lang=navigator.language;
    p.tz=Intl.DateTimeFormat().resolvedOptions().timeZone;
    p.ref=params.get('ref')||document.referrer||'direct';
    p.scrollMax=p.scrollMax||0;
    p.clickedLinks=p.clickedLinks||[];
    p.sectionsViewed=p.sectionsViewed||[];
    p.achievements=p.achievements||[];
    p.xp=p.xp||0;
    p.level=p.level||1;
    p.challengeDate=p.challengeDate||'';
    p.challengeDone=p.challengeDone||false;
    p.lastScrollY=p.lastScrollY||0;
    p.smartCtaDismissed=p.smartCtaDismissed||false;
    p.sessionClicks=0;
    p.sessionStart=Date.now();
    function save(){localStorage.setItem(k,JSON.stringify(p));}
    save();
    return{get:()=>p,save,addXp(n){p.xp+=n;const lvls=[0,50,150,300,500,800,1200];const nl=lvls.findIndex(t=>p.xp<t);p.level=nl===-1?lvls.length:nl;save();updateXpUI();},addClick(id){if(!p.clickedLinks.includes(id)){p.clickedLinks.push(id);save();}p.sessionClicks++;},addSection(id){if(!p.sectionsViewed.includes(id)){p.sectionsViewed.push(id);save();}},setScroll(pct){if(pct>p.scrollMax){p.scrollMax=pct;save();}p.lastScrollY=window.scrollY;save();}};
})();

// 1b. Device/Battery/Network Adaptation
(function(){
    const p=VDna.get();
    // Battery: reduce animations if low
    if(navigator.getBattery){navigator.getBattery().then(b=>{if(b.level<0.2&&!b.charging){document.documentElement.style.setProperty('--glow','transparent');document.querySelectorAll('.mesh div').forEach(d=>d.style.opacity='0.02');}});}
    // Network: degrade on slow connections
    const conn=navigator.connection||navigator.mozConnection;
    if(conn&&(conn.effectiveType==='2g'||conn.effectiveType==='slow-2g')){
        document.querySelectorAll('.mesh div').forEach(d=>d.style.display='none');
        document.getElementById('bgC').style.display='none';
    }
    // Performance: reduce particles on low-end
    if(navigator.hardwareConcurrency&&navigator.hardwareConcurrency<=2){
        window._lowEnd=true;
    }
})();

// 1c. Time-Aware Content Morphing
(function(){
    const h=parseInt(new Date().toLocaleString("en-US",{timeZone:"Africa/Cairo",hour:"numeric",hour12:false}));
    const vpEl=document.getElementById('vpText');
    const p=VDna.get();
    if(p.visits>2){
        // Returning visitor: skip generic intro
    } else if(h>=6&&h<12){
        // Morning: productivity
    } else if(h>=22||h<6){
        // Night owl: special accent
        document.documentElement.style.setProperty('--accent','#ff6b9d');
        document.documentElement.style.setProperty('--glowS','rgba(255,107,157,0.4)');
        document.documentElement.style.setProperty('--glow','rgba(255,107,157,0.15)');
    }
})();

// 1d. Return Visitor Memory
(function(){
    const p=VDna.get();
    if(p.visits>1&&p.lastScrollY>200){
        setTimeout(()=>{if(document.body.style.overflow==='auto')window.scrollTo({top:Math.min(p.lastScrollY,document.body.scrollHeight-window.innerHeight),behavior:'smooth'});},4500);
    }
})();

// ═════════════════════════════════════════════════
// SYSTEM 2: ENGAGEMENT ANALYTICS
// ═════════════════════════════════════════════════

// 2a. Scroll Depth Tracker
const scrollMilestones={25:false,50:false,75:false,100:false};
function trackScroll(){
    const pct=Math.round(scrollY/(document.documentElement.scrollHeight-innerHeight)*100);
    VDna.setScroll(pct);
    [25,50,75,100].forEach(m=>{if(pct>=m&&!scrollMilestones[m]){scrollMilestones[m]=true;VDna.addXp(1);if(m===100)Achieve.check('explorer');}});
}

// 2b. Section Dwell Time (Intersection Observer)
const sectionTimes={};
const sectionObs=new IntersectionObserver((entries)=>{
    entries.forEach(e=>{
        const id=e.target.dataset.section||e.target.id||'unknown';
        if(e.isIntersecting){sectionTimes[id]=Date.now();VDna.addSection(id);}
        else if(sectionTimes[id]){const dwell=Date.now()-sectionTimes[id];delete sectionTimes[id];}
    });
},{threshold:0.3});
setTimeout(()=>{document.querySelectorAll('.rv,[data-section]').forEach(el=>{if(!el.dataset.section){el.dataset.section=el.className.split(' ')[0]||'sec-'+Math.random().toString(36).slice(2,6);}sectionObs.observe(el);});},4000);

// 2c. Click Attribution
document.addEventListener('click',e=>{
    const link=e.target.closest('a[href],button[onclick],.qp,.lk,.nl,.vcb');
    if(link){
        const id=link.href||link.textContent.trim().slice(0,30);
        VDna.addClick(id);
        VDna.addXp(5);
        Achieve.check('connector');
        // Check newsletter clicks for scholar
        const href=link.href||'';
        if(href.includes('newsletter')||href.includes('levelup')){
            const p=VDna.get();
            const nlClicks=p.clickedLinks.filter(l=>l.includes('newsletter')||l.includes('levelup'));
            if(nlClicks.length>=3)Achieve.check('scholar');
        }
        ChallengeSystem.checkProgress();
    }
});

// 2d. Engagement Score
function getEngagementScore(){
    const p=VDna.get();
    const scrollScore=Math.min(p.scrollMax/100*30,30);
    const timeScore=Math.min((Date.now()-p.sessionStart)/120000*20,20);
    const sectionScore=Math.min(p.sectionsViewed.length/8*20,20);
    const clickScore=Math.min(p.sessionClicks/3*15,15);
    const returnScore=Math.min(p.visits/3*15,15);
    return Math.round(scrollScore+timeScore+sectionScore+clickScore+returnScore);
}

// 2e. Smart CTA Escalation
let smartCtaShown=false;
function checkSmartCta(){
    const p=VDna.get();
    if(p.smartCtaDismissed||smartCtaShown)return;
    const score=getEngagementScore();
    if(score>=65){
        showSmartCta('high');smartCtaShown=true;
    } else if(score<25&&(Date.now()-p.sessionStart)>15000){
        showSmartCta('low');smartCtaShown=true;
    }
}
function showSmartCta(type){
    const cta=document.getElementById('smartCta'),link=document.getElementById('smartCtaLink'),title=document.getElementById('smartCtaTitle'),sub=document.getElementById('smartCtaSub'),icon=document.getElementById('smartCtaIcon');
    if(type==='high'){
        link.href='https://calendly.com/amrmelharony/30min';
        title.textContent="You seem interested — let's chat";
        sub.textContent='Book a free 30-minute call';
        icon.innerHTML='<i class="fa-solid fa-calendar-check"></i>';
    } else {
        link.href='https://www.linkedin.com/newsletters/levelup-your-leadership-6872921030353031168';
        title.textContent="Grab a free insight before you go";
        sub.textContent='Join 500+ leaders reading LevelUp';
        icon.innerHTML='<i class="fa-solid fa-envelope-open-text"></i>';
    }
    cta.classList.add('show');
    VDna.addXp(2);
}
window.dismissSmartCta=function(){
    document.getElementById('smartCta').classList.remove('show');
    const p=VDna.get();p.smartCtaDismissed=true;VDna.save();
};

// ═════════════════════════════════════════════════
// SYSTEM 3: DYNAMIC CONTENT ENGINE
// ═════════════════════════════════════════════════

// 3a. Contextual Hero (referrer-based)
(function(){
    const p=VDna.get();
    const vpEl=document.getElementById('vpText');
    if(p.visits>2&&vpEl){
        // Returning visitor: more personal
    }
    // Referrer-based adjustments handled by existing refMap
})();

// 3b. Personalized Recommendations
function showRecommendation(){
    const p=VDna.get();
    const container=document.getElementById('recContainer');
    if(!container)return;
    const clicked=p.clickedLinks.join(' ').toLowerCase();
    let rec=null;
    if(clicked.includes('adplist')||clicked.includes('mentor')){
        rec={icon:'fa-book',label:'Since you like mentoring...',title:'Read The Bilingual Executive',href:'https://bilingualexecutive.amrelharony.com/'};
    } else if(clicked.includes('bilingual')||clicked.includes('book')){
        rec={icon:'fa-users',label:'Loved the book?',title:'Join Fintech Bilinguals Community',href:'https://www.linkedin.com/company/fintech-bilinguals'};
    } else if(clicked.includes('fintech')){
        rec={icon:'fa-graduation-cap',label:'Want to go deeper?',title:'Get Free 1:1 Agile Coaching',href:'https://adplist.org/mentors/amr-elharony'};
    } else if(p.visits>1){
        rec={icon:'fa-calendar-check',label:'Ready to connect?',title:'Book a 30-Min Call with Amr',href:'https://calendly.com/amrmelharony/30min'};
    }
    if(rec){
        container.innerHTML=`<a href="${rec.href}" target="_blank" rel="noopener" class="rec-card"><div class="rec-icon"><i class="fa-solid ${rec.icon}"></i></div><div class="rec-meta"><div class="rec-label">${rec.label}</div><div class="rec-title">${rec.title}</div></div><div style="color:var(--sub);opacity:.4"><i class="fa-solid fa-arrow-right"></i></div></a>`;
    }
}
setTimeout(showRecommendation,5000);

// 3c. Live Typing Console
const consoleMessages=[
    ()=>`Amr is currently in Cairo · ${new Date().toLocaleString("en-US",{timeZone:"Africa/Cairo",hour:"numeric",minute:"numeric",hour12:true})}`,
    ()=>`${VDna.get().visits===1?'Welcome, new visitor':'Welcome back'} · Visit #${VDna.get().visits}`,
    ()=>{const m=1000+Math.floor(((Date.now()-new Date('2023-10-01').getTime())/2592000000)*80);return `${m.toLocaleString()}+ mentoring minutes and counting...`;},
    ()=>`Engagement score: ${getEngagementScore()}/100`,
    ()=>`Your device: ${VDna.get().device} · ${VDna.get().os} · ${VDna.get().browser}`,
    ()=>`${VDna.get().achievements.length}/${15} achievements unlocked`,
    ()=>`Running on ${navigator.hardwareConcurrency||'?'} cores · ${VDna.get().screen}`,
    ()=>'System status: all modules operational ✓',
];
let consoleIdx=0;
function typeConsole(){
    const el=document.getElementById('liveConsole');if(!el)return;
    const msg=consoleMessages[consoleIdx%consoleMessages.length]();
    consoleIdx++;
    let i=0;el.textContent='';
    const iv=setInterval(()=>{if(i<msg.length){el.textContent=msg.slice(0,i+1);i++;}else{el.innerHTML=msg+'<span class="cursor-blink"> ▊</span>';clearInterval(iv);}},30);
}
setTimeout(()=>{typeConsole();setInterval(typeConsole,8000);},5000);

// ═════════════════════════════════════════════════
// SYSTEM 4: GAMIFICATION LAYER (ADVANCED)
// ═════════════════════════════════════════════════

const BADGES=[
    {id:'explorer',emoji:'🔍',name:'Explorer',desc:'Scrolled to 100%',rarity:'common',xp:25},
    {id:'regular',emoji:'🔄',name:'Regular',desc:'Visited 3+ times',rarity:'common',xp:25},
    {id:'connector',emoji:'🤝',name:'Connector',desc:'Clicked a link',rarity:'common',xp:20},
    {id:'scholar',emoji:'📖',name:'Scholar',desc:'Read all 3 newsletters',rarity:'rare',xp:40},
    {id:'nightowl',emoji:'🌙',name:'Night Owl',desc:'Visited midnight–5AM',rarity:'rare',xp:40},
    {id:'secret',emoji:'🤫',name:'Secret Agent',desc:'Found the easter egg',rarity:'epic',xp:60},
    {id:'shaker',emoji:'📱',name:'Shaker',desc:'Unlocked contact section',rarity:'rare',xp:35},
    {id:'streak5',emoji:'🔥',name:'Streak Master',desc:'5+ day visit streak',rarity:'epic',xp:60},
    {id:'globe',emoji:'🌍',name:'Globetrotter',desc:'Visited from outside Egypt',rarity:'rare',xp:35},
    {id:'speed',emoji:'⚡',name:'Speed Reader',desc:'Reached bottom in <30s',rarity:'epic',xp:50},
    {id:'deep',emoji:'🧠',name:'Deep Diver',desc:'Spent 3+ minutes exploring',rarity:'common',xp:25},
    {id:'social',emoji:'🔗',name:'Networker',desc:'Clicked 5+ different links',rarity:'rare',xp:40},
    {id:'collector',emoji:'🏆',name:'Collector',desc:'Unlocked 8 badges',rarity:'legendary',xp:100},
    {id:'certified',emoji:'📜',name:'Cert Inspector',desc:'Visited 3+ certifications',rarity:'rare',xp:35},
    {id:'bilingual',emoji:'🌐',name:'Bilingual',desc:'Switched to Arabic mode',rarity:'common',xp:20},
];

const LEVEL_NAMES=['Visitor','Curious','Explorer','Engaged','Fan','Superfan','Legend'];
const LEVEL_COLORS=['var(--sub)','var(--accent)','#3b82f6','#a855f7','#f97316','#ef4444','#fbbf24'];
const RARITY_ORDER={common:0,rare:1,epic:2,legendary:3};

// Combo System
const Combo=(function(){
    let count=0,timer=null;
    function hit(){
        count++;if(timer)clearTimeout(timer);
        timer=setTimeout(()=>{count=0;document.getElementById('comboIndicator').classList.remove('show');},8000);
        if(count>=2){
            const el=document.getElementById('comboIndicator');
            document.getElementById('comboCount').textContent='×'+count;
            document.getElementById('comboMult').textContent=Math.min(count,5)+'× XP';
            el.classList.add('show');
        }
        return Math.min(count,5);// Max 5x multiplier
    }
    return{hit,get:()=>count};
})();

const Achieve=(function(){
    const shown={};
    const queue=[];
    let toastActive=false;
    let prevLevel=VDna.get().level;
    function processQueue(){
        if(queue.length===0){toastActive=false;return;}
        toastActive=true;
        const item=queue.shift();
        if(item._levelUp)showLevelUpToast(item);
        else showToast(item);
        setTimeout(processQueue,4800);
    }
    function check(id){
        if(shown[id])return;
        const p=VDna.get();
        if(p.achievements.includes(id))return;
        shown[id]=true;
        const badge=BADGES.find(b=>b.id===id);
        if(!badge)return;
        // Timestamp the unlock
        if(!p.achieveTimes)p.achieveTimes={};
        p.achieveTimes[id]=Date.now();
        p.achievements.push(id);VDna.save();
        // XP with combo multiplier
        const mult=Combo.hit();
        const xp=badge.xp*(mult>=2?mult:1);
        VDna.addXp(xp);
        badge._earnedXp=xp;badge._combo=mult;
        queue.push(badge);
        // Check for level up
        const newLevel=VDna.get().level;
        if(newLevel>prevLevel){queue.push({_levelUp:true,level:newLevel});prevLevel=newLevel;}
        // Check collector badge
        if(p.achievements.length>=8)check('collector');
        // Trophy button notification dot
        const dot=document.getElementById('trophyDot');if(dot)dot.style.display='block';
        if(!toastActive)processQueue();
    }
    return{check};
})();

// Enhanced Toast System
function showToast(badge){
    const container=document.getElementById('toastContainer');
    const toast=document.createElement('div');
    const rarityClass=badge.rarity||'common';
    toast.className='toast '+rarityClass;
    const rarityLabel={common:'Common',rare:'✦ Rare',epic:'✦✦ Epic',legendary:'★ Legendary'}[rarityClass];
    const rarityColor={common:'#6b7a90',rare:'#3b82f6',epic:'#a855f7',legendary:'#fbbf24'}[rarityClass];
    toast.innerHTML=`<div class="toast-shimmer"></div><div class="toast-emoji">${badge.emoji}</div><div class="toast-body"><div class="toast-title">Achievement Unlocked!</div><div class="toast-desc">${badge.name} — ${badge.desc}</div><div class="toast-xp">+${badge._earnedXp||badge.xp} XP${badge._combo>=2?' (×'+badge._combo+' combo!)':''}</div><div class="toast-rarity" style="color:${rarityColor}">${rarityLabel}</div></div>`;
    container.appendChild(toast);
    setTimeout(()=>toast.classList.add('show'),50);
    setTimeout(()=>{toast.classList.remove('show');setTimeout(()=>toast.remove(),500);},4200);
    if(navigator.vibrate){
        const patterns={common:[80,40,80],rare:[80,40,80,40,120],epic:[60,30,60,30,60,30,200],legendary:[100,50,100,50,100,50,300]};
        navigator.vibrate(patterns[rarityClass]||[80]);
    }
}

function showLevelUpToast(item){
    const container=document.getElementById('toastContainer');
    const toast=document.createElement('div');
    toast.className='toast toast-levelup';
    const name=LEVEL_NAMES[item.level-1]||'Legend';
    toast.innerHTML=`<div class="toast-shimmer"></div><div class="toast-emoji">🎉</div><div class="toast-body"><div class="toast-title">Level Up!</div><div class="toast-desc">You reached Level ${item.level}: ${name}</div><div class="toast-xp">Keep exploring to unlock more badges</div></div>`;
    container.appendChild(toast);
    setTimeout(()=>toast.classList.add('show'),50);
    setTimeout(()=>{toast.classList.remove('show');setTimeout(()=>toast.remove(),500);},4200);
    if(navigator.vibrate)navigator.vibrate([100,80,100,80,100,80,300]);
}

// Enhanced XP UI
function updateXpUI(){
    const p=VDna.get();
    const lvls=[0,50,150,300,500,800,1200];
    const currLvlXp=lvls[p.level-1]||0;
    const nextLvlXp=lvls[p.level]||lvls[lvls.length-1];
    const pct=Math.min(((p.xp-currLvlXp)/(nextLvlXp-currLvlXp))*100,100);
    const xpText=document.getElementById('xpText');
    const xpFill=document.getElementById('xpBarFill');
    const xpLvl=document.getElementById('xpLevel');
    if(xpText)xpText.textContent=p.xp+' XP';
    if(xpFill)xpFill.style.width=pct+'%';
    if(xpLvl){
        const name=LEVEL_NAMES[p.level-1]||'Legend';
        const color=LEVEL_COLORS[p.level-1]||'#fbbf24';
        xpLvl.textContent='LVL '+p.level+' · '+name;
        xpLvl.style.color=color;
        xpLvl.style.background=color.replace(')',',0.1)').replace('var(','rgba(').replace('--sub','107,122,144').replace('--accent','0,225,255');
    }
}
setTimeout(updateXpUI,3000);

// Enhanced Trophy Case
function openTrophy(){
    const p=VDna.get();
    const unlockedCount=p.achievements.length;
    const totalCount=BADGES.length;
    const pct=Math.round((unlockedCount/totalCount)*100);
    // Progress ring
    const circ=276.5;
    const ring=document.getElementById('trophyRing');
    setTimeout(()=>{ring.style.strokeDashoffset=circ-(circ*pct/100);},100);
    document.getElementById('trophyPct').textContent=pct+'%';
    // Stats
    document.getElementById('trophySBadges').textContent=unlockedCount+'/'+totalCount;
    document.getElementById('trophySXp').textContent=p.xp;
    document.getElementById('trophySLevel').textContent=p.level;
    // XP bar
    const lvls=[0,50,150,300,500,800,1200];
    const currLvlXp=lvls[p.level-1]||0;
    const nextLvlXp=lvls[p.level]||lvls[lvls.length-1];
    const xpPct=Math.min(((p.xp-currLvlXp)/(nextLvlXp-currLvlXp))*100,100);
    document.getElementById('trophyXpFill').style.width=xpPct+'%';
    const name=LEVEL_NAMES[p.level-1]||'Legend';
    document.getElementById('trophyLevel').textContent=`${name} · ${nextLvlXp-p.xp} XP to Level ${p.level+1}`;
    // Build grid grouped by rarity
    const grid=document.getElementById('trophyGrid');
    let html='';
    ['legendary','epic','rare','common'].forEach(tier=>{
        const badges=BADGES.filter(b=>b.rarity===tier);
        if(badges.length===0)return;
        const tierLabel={legendary:'★ Legendary',epic:'✦ Epic',rare:'✦ Rare',common:'Common'}[tier];
        html+=`<div class="trophy-tier-label" style="grid-column:1/-1">${tierLabel}</div>`;
        badges.forEach(b=>{
            const unlocked=p.achievements.includes(b.id);
            const time=p.achieveTimes&&p.achieveTimes[b.id]?new Date(p.achieveTimes[b.id]).toLocaleDateString():'';
            html+=`<div class="trophy-badge ${unlocked?'unlocked':' locked'} ${tier}"><div class="trophy-badge-emoji">${unlocked?b.emoji:'🔒'}</div><div class="trophy-badge-name">${b.name}</div><div class="trophy-badge-desc">${b.desc}</div><span class="trophy-badge-rarity ${tier}">${b.xp} XP</span>${unlocked&&time?'<div class="trophy-badge-time">'+time+'</div>':''}</div>`;
        });
    });
    grid.innerHTML=html;
    // Hide notification dot
    const dot=document.getElementById('trophyDot');if(dot)dot.style.display='none';
    document.getElementById('trophyOverlay').classList.add('show');
}
window.closeTrophy=function(){document.getElementById('trophyOverlay').classList.remove('show');};
// Share progress
window.shareTrophy=function(){
    const p=VDna.get();
    const name=LEVEL_NAMES[p.level-1]||'Legend';
    const text=`🏆 I'm Level ${p.level} (${name}) on amrelharony.com!\n${p.achievements.length}/${BADGES.length} badges · ${p.xp} XP\nCan you beat my score?`;
    if(navigator.share){navigator.share({title:'My Trophy Progress',text,url:'https://amrelharony.com'}).catch(()=>{});}
    else{navigator.clipboard.writeText(text).then(()=>{const btn=document.querySelector('.trophy-share-btn');btn.textContent='✓ Copied!';setTimeout(()=>{btn.innerHTML='<i class="fa-solid fa-share" style="margin-right:4px"></i>Share Progress';},2000);});}
};
setTimeout(()=>{const btn=document.getElementById('trophyBtn');btn.style.display='flex';btn.addEventListener('click',openTrophy);document.getElementById('termBtn').style.display='flex';document.getElementById('gameBtn').style.display='flex';},4000);

// Auto-check achievements on load
(function(){
    const p=VDna.get();
    if(p.visits>=3)Achieve.check('regular');
    const cairoH=parseInt(new Date().toLocaleString("en-US",{timeZone:"Africa/Cairo",hour:"numeric",hour12:false}));
    if(cairoH>=0&&cairoH<5)Achieve.check('nightowl');
    const streak=parseInt(localStorage.getItem('streak')||'0');
    if(streak>=5)Achieve.check('streak5');
    // Speed Reader
    const loadTime=Date.now();
    let speedDone=false;
    const speedCheck=()=>{if(speedDone)return;const pct=scrollY/(document.documentElement.scrollHeight-innerHeight);if(pct>0.95&&(Date.now()-loadTime)<30000){speedDone=true;Achieve.check('speed');removeEventListener('scroll',speedCheck);}};
    addEventListener('scroll',speedCheck,{passive:true});
    setTimeout(()=>{speedDone=true;removeEventListener('scroll',speedCheck);},35000);
    // Globetrotter
    if(p.tz&&!p.tz.includes('Cairo')&&!p.tz.includes('Africa'))Achieve.check('globe');
    // Deep Diver: 3 min timer
    setTimeout(()=>Achieve.check('deep'),180000);
    // Social Networker: check existing clicks
    if(p.clickedLinks.length>=5)Achieve.check('social');
    // Cert Inspector: check cert clicks
    const certClicks=p.clickedLinks.filter(l=>l.includes('credly')||l.includes('certmetrics')||l.includes('cdmp')||l.includes('datacamp'));
    if(certClicks.length>=3)Achieve.check('certified');
})();

// Hook easter egg achievement
const origShowEgg=showEgg;
showEgg=function(){origShowEgg();Achieve.check('secret');};
// Hook shake contact achievement
const origReveal=revealContact;
revealContact=function(){origReveal();Achieve.check('shaker');};
// Hook language toggle for bilingual badge
document.getElementById('langBtn').addEventListener('click',()=>{Achieve.check('bilingual');});
// Track social networker on clicks
document.addEventListener('click',e=>{
    const p=VDna.get();
    if(p.clickedLinks.length>=5)Achieve.check('social');
    // Cert inspector
    const certClicks=p.clickedLinks.filter(l=>l.includes('credly')||l.includes('certmetrics')||l.includes('cdmp')||l.includes('datacamp'));
    if(certClicks.length>=3)Achieve.check('certified');
},{passive:true});

const ChallengeSystem={checkProgress(){}};

// Engagement check interval
setInterval(checkSmartCta,5000);

// ═════════════════════════════════════════════════
// FEATURE: MICRO-ANIMATIONS (Scroll-triggered)
// ═════════════════════════════════════════════════
(function(){
    if(reducedMotion)return;
    // Only apply to elements NOT already animated by GSAP (.rv class)
    const targets=[
        {sel:'.cert-card',cls:'sa-scale'},
        {sel:'.tl-item.tl-era',cls:'sa-left'},
        {sel:'.tl-item.tl-sub',cls:'sa-left'},
        {sel:'.insight-card',cls:'sa-right'},
        {sel:'.reading-card',cls:'sa-right'},
        {sel:'.rec-card',cls:'sa-right'}
    ];
    targets.forEach(({sel,cls})=>{
        document.querySelectorAll(sel).forEach(el=>{
            if(!el.classList.contains('rv')&&!el.classList.contains('sa')){el.classList.add('sa',cls);}
        });
    });
    const saObs=new IntersectionObserver((entries)=>{
        entries.forEach(e=>{
            if(e.isIntersecting){
                const parent=e.target.parentElement;
                const siblings=Array.from(parent.querySelectorAll('.sa:not(.vis)'));
                const idx=siblings.indexOf(e.target);
                setTimeout(()=>{e.target.classList.add('vis');},idx*80);
                saObs.unobserve(e.target);
            }
        });
    },{threshold:0.15,rootMargin:'0px 0px -40px 0px'});
    setTimeout(()=>{
        document.querySelectorAll('.sa').forEach(el=>saObs.observe(el));
    },4200);
})();

// ═════════════════════════════════════════════════
// FEATURE: TYPING TERMINAL
// ═════════════════════════════════════════════════
const TermCmds={
    help:()=>'<span class="term-accent">Available commands:</span>\n  <span class="term-green">about</span>     — Who is Amr?\n  <span class="term-green">certs</span>     — List certifications\n  <span class="term-green">skills</span>    — Core skills\n  <span class="term-green">contact</span>   — Get in touch\n  <span class="term-green">book</span>      — About The Bilingual Executive\n  <span class="term-green">stats</span>     — Fun stats\n  <span class="term-green">badges</span>    — Achievement progress\n  <span class="term-green">snake</span>     — Play Snake 🐍\n  <span class="term-green">clear</span>     — Clear terminal\n  <span class="term-green">exit</span>      — Close terminal',
    about:()=>'<span class="term-accent">Amr Elharony</span>\nDelivery Lead · Mentor · Fintech Author & Speaker\nScrum Master at Banque Misr | DBA in Digital Transformation\n\nI help banks and FinTech teams ship digital products faster\nthrough agile delivery and data-driven decisions.',
    certs:()=>'<span class="term-accent">Certifications (12):</span>\n  🎯 PMP · 📋 PSM II · 📦 PSPO II · 📊 PMI-ACP\n  🔄 SAFe® 6 SM · 🧠 PSK I · 🏗️ ICAgile ATF\n  💾 CDMP · 📈 Datacamp Pro · ⚙️ Jira Cloud\n  🏦 CEDF · 🎓 DBA Digital Transformation',
    skills:()=>'<span class="term-accent">Core Skills:</span>\n  Agile/Scrum · Kanban · SAFe · Data Analytics\n  Digital Transformation · Stakeholder Management\n  FinTech · Project Management · Mentoring\n  Python · SQL · Jira · Confluence',
    contact:()=>'<span class="term-accent">Contact Amr:</span>\n  📧 a.elharony@gmail.com\n  🔗 linkedin.com/in/amrmelharony\n  📅 calendly.com/amrmelharony/30min\n  🌐 amrelharony.com',
    book:()=>'<span class="term-accent">📚 The Bilingual Executive</span>\nLeadership Communication for a Bilingual World\n\nAvailable in: Print · eBook · AI Audiobook\n→ bilingualexecutive.amrelharony.com',
    stats:()=>{const p=VDna.get();return `<span class="term-accent">Your Session Stats:</span>\n  Visits: ${p.visits} · Scroll: ${p.scrollMax}%\n  Badges: ${p.achievements.length}/15 · XP: ${p.xp}\n  Device: ${p.device} · ${p.browser}`;},
    badges:()=>{const p=VDna.get();return '<span class="term-accent">Badges ('+p.achievements.length+'/15):</span>\n'+BADGES.map(b=>'  '+(p.achievements.includes(b.id)?b.emoji:' 🔒')+' '+b.name+' — '+b.desc).join('\n');},
    snake:()=>{closeTerm();setTimeout(openGame,400);return '<span class="term-green">Launching Snake...</span>';},
    clear:()=>'__CLEAR__',
    exit:()=>{closeTerm();return '';}
};
window.openTerm=function(){document.getElementById('termOverlay').classList.add('show');setTimeout(()=>document.getElementById('termInput').focus(),300);};
window.closeTerm=function(){document.getElementById('termOverlay').classList.remove('show');};
document.getElementById('termInput').addEventListener('keydown',e=>{
    if(e.key==='Enter'){
        const input=e.target;const cmd=input.value.trim().toLowerCase();input.value='';
        const body=document.getElementById('termBody');
        body.innerHTML+=`<div class="term-line"><span class="term-prompt">❯</span> <span class="term-cmd">${cmd}</span></div>`;
        const fn=TermCmds[cmd];
        if(fn){const out=fn();if(out==='__CLEAR__'){body.innerHTML='<div class="term-line"><span class="term-green">Terminal cleared.</span></div>';}else if(out){body.innerHTML+=`<div class="term-line"><span class="term-out">${out.replace(/\n/g,'</span></div><div class="term-line"><span class="term-out">')}</span></div>`;}}
        else if(cmd)body.innerHTML+=`<div class="term-line"><span class="term-warn">Command not found: ${cmd}. Type <span class="term-accent">help</span></span></div>`;
        body.scrollTop=body.scrollHeight;
    }
});


// ═════════════════════════════════════════════════
// FEATURE: TESTIMONIAL CAROUSEL (80+ recommendations)
// ═════════════════════════════════════════════════
(function(){
const TC=[
{c:'strategy',n:'Ayman Hassan Soliman',r:'Senior Deputy GM',q:'A strategic catalyst for change... masterfully leverages technology to engineer fundamental shifts in systems and culture.'},
{c:'strategy',n:'Alaa Ghaly',r:'Assistant Manager',q:'Rare talent who sees the future of our data landscape... and leads his team to drive that change.'},
{c:'strategy',n:'Romany Youssef',r:'GTB MIS Manager',q:'Demonstrates remarkable courage in challenging the status quo... catalyzing shifts in both systems and attitude.'},
{c:'strategy',n:'Ayman El Menawy',r:'Senior Deputy GM',q:'Has a sharp strategic mindset, always seeing the big picture while mastering the details.'},
{c:'strategy',n:'Ahmed Arafat, MBA',r:'Deputy GM',q:'Transparent and forward-thinking... leads with clarity, empathy, and a relentless focus on driving value.'},
{c:'strategy',n:'Karima Othman',r:'Project Manager',q:'Expertise in leveraging technology to bring about transformative change... a valuable addition to any bank.'},
{c:'strategy',n:'Sameh Elebiary',r:'Corporate Credit Analyst',q:'The rare talent who has the ability to challenge, teach, and lead to drive change.'},
{c:'strategy',n:'Mohamed Taha',r:'Data Steward',q:'A strategic thinker who connects dots across different lines of businesses... You will be mesmerized!'},
{c:'strategy',n:'Mohamed Badr',r:'Core Banking Support',q:'A creative big thinker whose enthusiasm for financial technology is impressive.'},
{c:'strategy',n:'Sayed Hamed',r:'Corporate Relationship Manager',q:'He wants to drive positive change... gets the big picture and how to tactically achieve it.'},
{c:'strategy',n:'Marwa Rashed',r:'ARM Large Corporate',q:'Always looking ahead and thinking about how technology can improve businesses.'},
{c:'tech',n:'Mohamed Abaza',r:'Lead Data Scientist',q:'Wide knowledge in multidisciplinary topics, almost like a Wikipedia moving on Earth!'},
{c:'tech',n:'Eslam Youssef',r:'Senior Data Analyst',q:'Working with him was transformative. His deep tech expertise and talent for fintech set him apart.'},
{c:'tech',n:'Abdelrhman Mabrouk',r:'Corporate Credit Certified',q:'His technical expertise in data analysis was a huge asset... significantly boosted our problem-solving.'},
{c:'tech',n:'Youssef Saeed',r:'Data Analytics Engineer',q:'Exceptional skills in technology combined with outstanding interpersonal abilities.'},
{c:'tech',n:'Haitham Adel',r:'Deputy GM',q:'A tech-savvy professional... his passion for technology and innovative problem-solving are valuable assets.'},
{c:'tech',n:'Ahmed Mostafa',r:'Deputy GM',q:'Excels at solving problems... assimilates the newest concepts in technology & data analytics.'},
{c:'tech',n:'George Hishmat',r:'Deputy GM',q:'Resourceful, creative problem solver... his ability to explain technical concepts is outstanding.'},
{c:'tech',n:'Omar Nabhan',r:'DGM',q:'Wide knowledge in all technology aspects related to banking systems... provides outstanding performance.'},
{c:'tech',n:'Ahmed Refaat',r:'Business Analyst',q:'A hard worker and ambitious person... multi-skilled specially with anything related to technology.'},
{c:'tech',n:'Amr Refaat',r:'Large Corporate Dept Head',q:'One of the smartest partners I have worked with... multi-skilled especially in technology.'},
{c:'tech',n:'John Talaat',r:'Assistant Relationship Manager',q:'The Tech guy of our department... keep raising the bar high as always.'},
{c:'tech',n:'Essam Arsanious',r:'Team Leader',q:'Gifted in the field of technology... strong critical thinking ability to see through complex problems.'},
{c:'tech',n:'Emam M. SAAD',r:'Treasury & Capital Markets',q:'Highly recommend him as a digitalization and fintech expert... amazing at his job!'},
{c:'tech',n:'Dina Tony',r:'Senior Corporate RM',q:'The complete package... blend of business acumen and technology skills.'},
{c:'mentor',n:'ADPList Mentee',r:'Jan 2026',q:'Guided me through complex topics with clarity and efficiency... exceeded my expectations.'},
{c:'mentor',n:'Ahmed Shewail',r:'Senior Banker',q:'Provided exceptional motivation and problem-solving strategies, which truly helped me tackle my challenges.'},
{c:'mentor',n:'Hossam Elden Abdelhamed',r:'Data Architect',q:'Very supportive and explained everything clearly... helped me understand my career direction.'},
{c:'mentor',n:'Alaa Elnakeeb',r:'AI & Data Analytics',q:'Discussed a potential roadmap for becoming a data science engineer... a truly helpful session.'},
{c:'mentor',n:'Omar Ayoub',r:'Engineering Student',q:'Helped me organize everything step by step and clarified the actions I should take moving forward.'},
{c:'mentor',n:'Hazem Amr',r:'Data Analyst',q:'Before the session, I felt lost... throughout our discussion, everything became clear.'},
{c:'mentor',n:'Laila Sami',r:'Student, UOWD',q:'Invaluable guidance on navigating the Egyptian job market and effectively tailoring my CV.'},
{c:'mentor',n:'Abdelrhman Afify',r:'Data Engineer',q:'Explained things clearly... feeling much more confident and excited to take the next steps.'},
{c:'mentor',n:'Rabab El Gendy',r:'CS Representative',q:'Walked away with useful knowledge... His sincere willingness to support others stood out.'},
{c:'mentor',n:'Mohamed Sror',r:'Microfinance Specialist',q:'Exceeded my expectations... helped me organize my thoughts and recognize my next steps.'},
{c:'mentor',n:'Eman Gahallah',r:'Engineer',q:'Genuinely wants to help others and is generous with his knowledge.'},
{c:'mentor',n:'Amr Elsharkawy',r:'Student',q:'Clear and practical advice on improving my CV and portfolio.'},
{c:'mentor',n:'Mazen Hatem',r:'Student',q:'Provided me with numerous resources to help me stay on track in the data field.'},
{c:'mentor',n:'Malak Soula',r:'Data Scientist',q:'Outstanding and so helpful to guide me to what I should do as a next step.'},
{c:'mentor',n:'AbdAlrahman Hassan',r:'Student',q:'Shared a lot of information... made me know what I can do to start in data analysis.'},
{c:'agile',n:'Esmail Eldally',r:'Data Analyst',q:'Outstanding Scrum Master... organized, supportive, and excellent at guiding the team to achieve sprint goals.'},
{c:'agile',n:'Kareem Amr Khedr',r:'Corporate Credit Analyst',q:'Deep expertise in people management... ability to deal with difficult people is invaluable.'},
{c:'agile',n:'Mahmoud Saied',r:'ETL Specialist',q:'A mentor and guide who empowers those around him to achieve their full potential.'},
{c:'agile',n:'Noureldeen Saad',r:'Relationship Manager',q:'Sets an example for everyone... empowers and supports his team and encourages their growth.'},
{c:'agile',n:'Maha Mohamed',r:'Officer-Account Planning',q:'A true visionary... looks out for each member of his team by empowering them.'},
{c:'agile',n:'Samar Gaber',r:'Scrum Master',q:'Trustworthy and values-driven... his collaborative approach fosters a positive work environment.'},
{c:'agile',n:'Amr Hussien',r:'Deputy GM',q:'His coaching mastery comes naturally... full of hope and radiates energy.'},
{c:'agile',n:'Ahmed Omar',r:'Digital Transformation Office',q:'Does a wonderful job balancing high-stakes responsibilities with a positive attitude.'},
{c:'agile',n:'Mahmoud Ghazy',r:'Senior Data Governance',q:'Excels at managing challenging situations... consistently brings out the best in people.'},
{c:'agile',n:'Dr. Haythm EL Hawary',r:'Lead Auditor',q:'The best of employees we have in Banque Misr... smart and patient man.'},
{c:'results',n:'Omar Mohey',r:'Senior Data Steward',q:'Amr gets things done... delivering outstanding results on even the most complex projects.'},
{c:'results',n:'Ibrahim Zidan',r:'PMO Manager',q:'Master of solving complex business challenges... turns ideas into impactful solutions.'},
{c:'results',n:'Mahmoud Tag ElDien',r:'SME Credit Analyst',q:'Combines deep business knowledge with data-driven insights to create measurable impact.'},
{c:'results',n:'Ola Abdelrahman',r:'Relationship Manager',q:'Amr is always to be trusted to do what he says he will do.'},
{c:'results',n:'Abd El Rahman Harby',r:'Assistant GM',q:'Consistently went the extra mile... tackled tasks with enthusiasm and professionalism.'},
{c:'results',n:'Mohamed Magdy',r:'ATM Switch Team Leader',q:'Hyper-analytical and hardworking... Amr has excellent product sense! Simply the best.'},
{c:'results',n:'Amr Tarek',r:'Relationship Manager',q:'Consistently goes above and beyond to get the job done. Creative thinker and hard worker.'},
{c:'results',n:'Moataz Hamed',r:'Risk Manager',q:'Hard-working... always motivated and knows what it takes to do the job well.'},
{c:'results',n:'Tamer Afifi',r:'Head of Emerging Corporate',q:'Approaches every challenge with clarity, creativity, and a solution-oriented mindset.'},
{c:'results',n:'Ahmed Gomaa',r:'Data Modeling',q:'Excellent, dedicated, and reliable working partner with an outstanding way of thinking.'},
{c:'team',n:'Walid Gafeer',r:'Senior RM',q:'EQ is off the charts... a knack for improving morale just by being himself.'},
{c:'team',n:'Amr ELHossiny',r:'Digital Platforms Manager',q:'A game-changer in my life... stepping up as a mentor when I least expected it.'},
{c:'team',n:'Yehia Sharaf',r:'Relationship Manager',q:'Down to earth and approachable... great at building long lasting connections.'},
{c:'team',n:'Mohamed Elabasy',r:'Corporate Banking Team Leader',q:'Friendly and easy to talk to... great at connecting with people.'},
{c:'team',n:'Mahmoud Saeed',r:'Structured Finance Manager',q:'In a word, delightful... unique personal traits and always willing to help.'},
{c:'team',n:'Mahmoud Hamdy',r:'Assistant RM',q:'Undeniable charisma... one of the best colleagues I have ever known.'},
{c:'team',n:'Amr Said',r:'Senior RM',q:'Full of energy and passion... his positive vibe rubs off on everyone around him.'},
{c:'team',n:'Mohamed Fathy',r:'Relationship Manager',q:'Always professional... loves learning and sharing what he knows to help others.'},
{c:'team',n:'Abdelrahman Badoa Ayad',r:'Data Quality Specialist',q:'Infectious enthusiasm... fosters a cohesive team dynamic.'},
{c:'team',n:'Ismail Shaaban',r:'Senior Project Manager',q:'Outstanding in professional and personal life... always made sure everyone had support.'},
{c:'team',n:'Ahmed Dahi',r:'Software Engineer',q:'Knows how to make things happen with a blend of being nice and assertive.'},
{c:'team',n:'Wael Kammar',r:'Senior RM',q:'So easy to work with. His unique style and humor enhance the effectiveness of his team.'},
{c:'team',n:'Assem Gamal',r:'Software Developer',q:'Exceptionally motivated... possesses a rare combination of visionary thinking and practicality.'},
{c:'team',n:'Nada Abdelaziz',r:'Assistant GM',q:'Inspirational and motivating partner... highest degrees of professionalism and integrity.'},
{c:'team',n:'Mahmoud Ahmed Morsy',r:'Senior RM',q:'Candid, transparent and collaborative... focused on helping others around him.'},
{c:'team',n:'Ahmed M. Ali',r:'Application Support',q:'Always available to extend help... a very friendly and supportive person.'},
{c:'team',n:'Mohamed kamal',r:'Corporate RM',q:'Super understanding... great at lifting up everyone around him.'},
{c:'team',n:'Mohamed abdelmegeid',r:'RM Large Corporate',q:'Brings a ton of positive energy... makes everything feel fresh and exciting.'},
{c:'team',n:'Mohamed Hassan',r:'Senior Ops Officer',q:'An awesome teammate... always on the hunt for new ways to innovate.'},
{c:'team',n:'Eslam Maher',r:'Large Corporate RM',q:'A Rock Star... his work ethic and ability to solve problems have made a real impact.'},
{c:'team',n:'Ibrahim Shaaban',r:'Senior Corporate RM',q:'Active, fast learning, and open minded... the personality you need to build a successful team.'},
{c:'team',n:'Yassmin Qurtam',r:'Senior Credit Analyst',q:'Working with Amr is delightful... very professional and efficient.'},
{c:'team',n:'Hossam Aref',r:'Deputy GM',q:'Excellent participator in discussions, always adding value and helping you think broadly.'},
{c:'team',n:'Hesham Kamal El Mahdy',r:'Senior RM',q:'A very decent and helpful guy who always takes initiative.'},
{c:'team',n:'Ahmed hassan',r:'Senior RM',q:'Highly recommend him for his positive attitude and willingness to assist others.'},
{c:'team',n:'Saladin Gomaa',r:'Team Leader',q:'Great appetite for learning... a pleasure to have him as a colleague.'},
{c:'team',n:'Mohamed Abd El-Wahab',r:'Corporate Credit Analyst',q:'Rare to find someone who is both talented and modest at the same time.'},
{c:'team',n:'Mahmoud Hosny',r:'Corporate Credit Analyst',q:'Positivity, passion, and commitment to teamwork make him a joy to work with.'},
{c:'team',n:'Amr Awad',r:'Machine Learning Engineer',q:'A man of integrity.'},
];

const CATS={
    all:{label:'All',icon:'✦',color:'var(--accent)'},
    strategy:{label:'Strategy',icon:'🏛️',color:'#6366f1'},
    tech:{label:'Tech',icon:'🚀',color:'#00e1ff'},
    mentor:{label:'Mentoring',icon:'🎓',color:'#22c55e'},
    agile:{label:'Agile',icon:'⚡',color:'#f97316'},
    results:{label:'Results',icon:'🛠️',color:'#ef4444'},
    team:{label:'Culture',icon:'🤝',color:'#a855f7'}
};

const AVATAR_COLORS=['#6366f1','#00e1ff','#22c55e','#f97316','#ef4444','#a855f7','#3b82f6','#ec4899','#14b8a6','#eab308'];

let currentCat='all',currentIdx=0,filtered=[],autoTimer=null,autoFill=null;

function getFiltered(cat){return cat==='all'?[...TC]:TC.filter(t=>t.c===cat);}

function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;}

function getInitials(name){const parts=name.split(' ');return parts.length>1?(parts[0][0]+parts[parts.length-1][0]).toUpperCase():name.substring(0,2).toUpperCase();}

function getAvatarColor(name){let h=0;for(let i=0;i<name.length;i++)h=name.charCodeAt(i)+((h<<5)-h);return AVATAR_COLORS[Math.abs(h)%AVATAR_COLORS.length];}

function buildCats(){
    const el=document.getElementById('tcCats');
    el.innerHTML=Object.keys(CATS).map(k=>{
        const cat=CATS[k];
        const count=k==='all'?TC.length:TC.filter(t=>t.c===k).length;
        return `<button class="tc-cat${k===currentCat?' active':''}" data-cat="${k}">${cat.icon} ${cat.label}<span class="tc-cat-count">${count}</span></button>`;
    }).join('');
    el.querySelectorAll('.tc-cat').forEach(btn=>{
        btn.addEventListener('click',()=>{
            currentCat=btn.dataset.cat;currentIdx=0;
            el.querySelectorAll('.tc-cat').forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');
            filtered=shuffle(getFiltered(currentCat));
            render();startAuto();
        });
    });
}

function buildSlide(t){
    const cat=CATS[t.c];
    const initials=getInitials(t.n);
    const bgColor=getAvatarColor(t.n);
    return `<div class="tc-slide"><div class="tc-card"><div class="tc-quote">${t.q}</div><div class="tc-author"><div class="tc-avatar" style="background:${bgColor}">${initials}</div><div class="tc-info"><div class="tc-name">${t.n}</div><div class="tc-role">${t.r}</div></div><span class="tc-cat-badge" style="color:${cat.color};background:${cat.color}15">${cat.icon} ${cat.label}</span></div></div></div>`;
}

function render(){
    const track=document.getElementById('tcTrack');
    track.innerHTML=filtered.map(buildSlide).join('');
    track.style.transform=`translateX(-${currentIdx*100}%)`;
    // Dots — show max 7
    const dots=document.getElementById('tcDots');
    const maxDots=Math.min(filtered.length,7);
    const startDot=Math.max(0,Math.min(currentIdx-3,filtered.length-maxDots));
    let dotsHtml='';
    for(let i=startDot;i<startDot+maxDots&&i<filtered.length;i++){
        dotsHtml+=`<div class="tc-dot${i===currentIdx?' active':''}" data-idx="${i}"></div>`;
    }
    dots.innerHTML=dotsHtml;
    dots.querySelectorAll('.tc-dot').forEach(d=>{d.addEventListener('click',()=>{currentIdx=parseInt(d.dataset.idx);goTo();startAuto();});});
    document.getElementById('tcCounter').textContent=`${currentIdx+1} / ${filtered.length}`;
}

function goTo(){
    document.getElementById('tcTrack').style.transform=`translateX(-${currentIdx*100}%)`;
    render();
}

function next(){currentIdx=(currentIdx+1)%filtered.length;goTo();}
function prev(){currentIdx=(currentIdx-1+filtered.length)%filtered.length;goTo();}

function startAuto(){
    stopAuto();
    const fill=document.getElementById('tcAutoFill');
    fill.classList.remove('running');fill.style.width='0%';
    void fill.offsetWidth;// Force reflow
    fill.classList.add('running');
    autoTimer=setTimeout(()=>{next();startAuto();},6000);
}
function stopAuto(){if(autoTimer){clearTimeout(autoTimer);autoTimer=null;}document.getElementById('tcAutoFill').classList.remove('running');}

// Init
filtered=shuffle(getFiltered('all'));
buildCats();render();

// Nav buttons
document.getElementById('tcPrev').addEventListener('click',()=>{prev();startAuto();});
document.getElementById('tcNext').addEventListener('click',()=>{next();startAuto();});

// Swipe support
let stx=0;const vp=document.getElementById('tcViewport');
vp.addEventListener('touchstart',e=>{stx=e.touches[0].clientX;stopAuto();},{passive:true});
vp.addEventListener('touchend',e=>{const dx=e.changedTouches[0].clientX-stx;if(Math.abs(dx)>40){dx<0?next():prev();}startAuto();},{passive:true});

// Pause auto on hover (desktop)
vp.addEventListener('mouseenter',stopAuto);
vp.addEventListener('mouseleave',startAuto);

// Start auto-play after delay
setTimeout(startAuto,5000);
})();

// ═════════════════════════════════════════════════
// FEATURE: FINTECH TRADER GAME — Mobile-optimized
// ═════════════════════════════════════════════════
let snakeGame=null,snakeDir={x:1,y:0};
window.openGame=function(){
    document.getElementById('gameOverlay').classList.add('show');
    startSnake();
};
window.closeGame=function(){
    document.getElementById('gameOverlay').classList.remove('show');
    if(snakeGame){clearInterval(snakeGame);snakeGame=null;}
};
window.restartSnake=function(){
    if(snakeGame){clearInterval(snakeGame);snakeGame=null;}
    startSnake();
};

function startSnake(){
    const c=document.getElementById('snakeCanvas'),ctx=c.getContext('2d');
    const container=c.parentElement;
    const maxW=Math.min(container.clientWidth-16,320);
    const cols=20,rows=20;
    const sz=Math.floor(maxW/cols);
    c.width=cols*sz;c.height=rows*sz;
    c.style.width=cols*sz+'px';c.style.height=rows*sz+'px';

    let snake=[{x:10,y:10}];
    snakeDir={x:1,y:0};
    let portfolio=0,pnl=0,streak=0,bestStreak=0,level=1,levelProgress=0;
    let gameOver=false,speed=130,moveCount=0;

    const ITEMS={
        coin:{emoji:'💰',value:100,color:'#fbbf24',msg:'+$100 Trade profit!'},
        gem:{emoji:'💎',value:250,color:'#a855f7',msg:'+$250 Diamond deal!'},
        rocket:{emoji:'🚀',value:500,color:'#22c55e',msg:'+$500 Moonshot! 🚀'},
        bomb:{emoji:'💣',value:-200,color:'#ef4444',msg:'-$200 Market crash!'},
        chart:{emoji:'📈',value:150,color:'#3b82f6',msg:'+$150 Bull run!'}
    };
    const itemTypes=['coin','coin','coin','coin','coin','chart','chart','gem','gem','rocket','bomb','bomb'];

    let items=[];
    let particles=[];
    let shieldActive=false;

    function spawnItem(){
        const type=itemTypes[Math.floor(Math.random()*itemTypes.length)];
        let x,y,valid=false;
        for(let tries=0;tries<50;tries++){
            x=Math.floor(Math.random()*cols);y=Math.floor(Math.random()*rows);
            if(!snake.some(s=>s.x===x&&s.y===y)&&!items.some(i=>i.x===x&&i.y===y)){valid=true;break;}
        }
        if(valid)items.push({x,y,type,timer:300+Math.floor(Math.random()*200)});
    }
    for(let i=0;i<3;i++)spawnItem();

    function spawnParticles(x,y,color,count){
        for(let i=0;i<count;i++){
            const angle=Math.random()*Math.PI*2;const sp=1+Math.random()*2;
            particles.push({x:x*sz+sz/2,y:y*sz+sz/2,vx:Math.cos(angle)*sp,vy:Math.sin(angle)*sp,life:20,color});
        }
    }

    function updateHUD(){
        document.getElementById('hudPortfolio').textContent='$'+portfolio.toLocaleString();
        const pnlEl=document.getElementById('hudPnl');
        pnlEl.textContent=(pnl>=0?'+':'')+' $'+Math.abs(pnl).toLocaleString();
        pnlEl.className='game-hud-val '+(pnl>=0?'profit':'loss');
        document.getElementById('hudLevel').textContent=level;
        document.getElementById('hudStreak').textContent=streak;
        document.getElementById('levelText').textContent='Q'+level;
        document.getElementById('levelFill').style.width=Math.min(levelProgress/10*100,100)+'%';
    }

    function draw(){
        // Background with subtle gradient
        const bgGrad=ctx.createRadialGradient(c.width/2,c.height/2,0,c.width/2,c.height/2,c.width/1.2);
        bgGrad.addColorStop(0,'#0a0e18');bgGrad.addColorStop(1,'#060910');
        ctx.fillStyle=bgGrad;ctx.fillRect(0,0,c.width,c.height);

        // Grid with depth fade
        for(let i=0;i<=cols;i++){
            const alpha=0.03+Math.abs(i-cols/2)/cols*0.04;
            ctx.strokeStyle=`rgba(0,225,255,${alpha})`;ctx.lineWidth=0.3;
            ctx.beginPath();ctx.moveTo(i*sz,0);ctx.lineTo(i*sz,c.height);ctx.stroke();}
        for(let i=0;i<=rows;i++){
            const alpha=0.03+Math.abs(i-rows/2)/rows*0.04;
            ctx.strokeStyle=`rgba(0,225,255,${alpha})`;ctx.lineWidth=0.3;
            ctx.beginPath();ctx.moveTo(0,i*sz);ctx.lineTo(c.width,i*sz);ctx.stroke();}

        // Items with rich glow + float animation
        items.forEach(item=>{
            const def=ITEMS[item.type];
            const t=Date.now()/1000;
            const pulse=0.7+Math.sin(t*2+item.x+item.y)*0.3;
            const floatY=Math.sin(t*1.5+item.x)*1.5;
            // Outer glow ring
            ctx.shadowColor=def.color;ctx.shadowBlur=14*pulse;
            ctx.fillStyle=def.color+'22';
            ctx.beginPath();ctx.arc(item.x*sz+sz/2,item.y*sz+sz/2+floatY,sz/2+2,0,Math.PI*2);ctx.fill();
            // Inner circle
            ctx.fillStyle=def.color+'44';
            ctx.beginPath();ctx.arc(item.x*sz+sz/2,item.y*sz+sz/2+floatY,sz/2-1,0,Math.PI*2);ctx.fill();
            ctx.shadowBlur=0;
            // Emoji
            ctx.font=(sz-2)+'px serif';ctx.textAlign='center';ctx.textBaseline='middle';
            ctx.fillText(def.emoji,item.x*sz+sz/2,item.y*sz+sz/2+floatY+1);
            // Expiry warning — pulsing red border
            if(item.timer<80){
                const warn=0.3+Math.sin(t*6)*0.4;
                ctx.strokeStyle=`rgba(239,68,68,${warn})`;ctx.lineWidth=1.5;
                ctx.beginPath();ctx.arc(item.x*sz+sz/2,item.y*sz+sz/2+floatY,sz/2+1,0,Math.PI*2);ctx.stroke();
            }
        });

        // Snake trail (ghost segments behind)
        if(snake.length>1){
            ctx.globalAlpha=0.06;
            for(let i=snake.length-1;i>=1;i--){
                const s=snake[i];const prev=snake[Math.min(i+1,snake.length-1)];
                ctx.fillStyle='#00e1ff';
                ctx.beginPath();ctx.arc(s.x*sz+sz/2,s.y*sz+sz/2,sz/3,0,Math.PI*2);ctx.fill();
            }
            ctx.globalAlpha=1;
        }

        // Snake body — gradient segments with glow
        snake.forEach((s,i)=>{
            const pct=1-i/Math.max(snake.length,1);
            if(i===0){
                // Head glow
                ctx.shadowColor='#00e1ff';ctx.shadowBlur=12;
                const hg=ctx.createLinearGradient(s.x*sz,s.y*sz,s.x*sz+sz,s.y*sz+sz);
                hg.addColorStop(0,'#00e1ff');hg.addColorStop(1,'#6366f1');
                ctx.fillStyle=hg;
                ctx.beginPath();ctx.roundRect(s.x*sz+0.5,s.y*sz+0.5,sz-1,sz-1,[5]);ctx.fill();
                ctx.shadowBlur=0;
                // Eyes — direction-aware
                ctx.fillStyle='#fff';
                let ex1,ey1,ex2,ey2;
                if(snakeDir.x===1){ex1=sz-5;ey1=3;ex2=sz-5;ey2=sz-5;}
                else if(snakeDir.x===-1){ex1=3;ey1=3;ex2=3;ey2=sz-5;}
                else if(snakeDir.y===-1){ex1=3;ey1=3;ex2=sz-5;ey2=3;}
                else{ex1=3;ey1=sz-5;ex2=sz-5;ey2=sz-5;}
                ctx.beginPath();ctx.arc(s.x*sz+ex1,s.y*sz+ey1,1.5,0,Math.PI*2);ctx.fill();
                ctx.beginPath();ctx.arc(s.x*sz+ex2,s.y*sz+ey2,1.5,0,Math.PI*2);ctx.fill();
                // Shield ring
                if(shieldActive){
                    const sGrad=ctx.createLinearGradient(s.x*sz-4,s.y*sz-4,s.x*sz+sz+4,s.y*sz+sz+4);
                    sGrad.addColorStop(0,'#22c55e');sGrad.addColorStop(1,'#3b82f6');
                    ctx.strokeStyle=sGrad;ctx.lineWidth=2;
                    ctx.beginPath();ctx.arc(s.x*sz+sz/2,s.y*sz+sz/2,sz/2+3,0,Math.PI*2);ctx.stroke();
                }
            } else {
                // Body — gradient fade with rounded segments
                const segGrad=ctx.createLinearGradient(s.x*sz,s.y*sz,s.x*sz+sz,s.y*sz+sz);
                const a1=Math.max(0.15+pct*0.55,0.1);const a2=Math.max(0.1+pct*0.4,0.08);
                segGrad.addColorStop(0,`rgba(0,225,255,${a1})`);
                segGrad.addColorStop(1,`rgba(99,102,241,${a2})`);
                ctx.fillStyle=segGrad;
                const gap=Math.max(1,Math.round(2-pct));
                ctx.beginPath();ctx.roundRect(s.x*sz+gap,s.y*sz+gap,sz-gap*2,sz-gap*2,[3-gap]);ctx.fill();
                // Segment inner highlight
                if(pct>0.5){ctx.fillStyle=`rgba(255,255,255,${pct*0.04})`;ctx.beginPath();ctx.roundRect(s.x*sz+gap+1,s.y*sz+gap+1,(sz-gap*2)/2,(sz-gap*2)/2,[2]);ctx.fill();}
            }
        });

        // Particles with size variation
        particles.forEach(p=>{
            ctx.globalAlpha=p.life/20;ctx.fillStyle=p.color;
            const r=1+p.life/10;
            ctx.beginPath();ctx.arc(p.x,p.y,r,0,Math.PI*2);ctx.fill();
            // Particle glow
            ctx.globalAlpha=p.life/60;
            ctx.beginPath();ctx.arc(p.x,p.y,r*2.5,0,Math.PI*2);ctx.fill();
        });
        ctx.globalAlpha=1;

        // Game over overlay
        if(gameOver){
            ctx.fillStyle='rgba(6,9,16,0.88)';ctx.fillRect(0,0,c.width,c.height);
            // Red warning lines
            ctx.strokeStyle='rgba(239,68,68,0.15)';ctx.lineWidth=1;
            for(let i=0;i<c.height;i+=4){ctx.beginPath();ctx.moveTo(0,i);ctx.lineTo(c.width,i);ctx.stroke();}
            // Title
            ctx.shadowColor='#ef4444';ctx.shadowBlur=20;
            ctx.fillStyle='#ef4444';ctx.font='bold 18px JetBrains Mono';ctx.textAlign='center';
            ctx.fillText('📉 MARGIN CALL',c.width/2,c.height/2-30);
            ctx.shadowBlur=0;
            ctx.fillStyle='#e2e8f0';ctx.font='bold 14px JetBrains Mono';
            ctx.fillText('$'+portfolio.toLocaleString(),c.width/2,c.height/2+2);
            ctx.fillStyle='#6b7280';ctx.font='10px JetBrains Mono';
            ctx.fillText('Best Streak: '+bestStreak+' · Q'+level,c.width/2,c.height/2+24);
            ctx.fillStyle='#4a5568';ctx.font='9px JetBrains Mono';
            ctx.fillText('Tap restart or press R',c.width/2,c.height/2+50);
        }
        updateHUD();
    }

    function update(){
        if(gameOver)return;
        moveCount++;
        let head={x:snake[0].x+snakeDir.x,y:snake[0].y+snakeDir.y};

        // Wall wrap-around (go through walls)
        if(head.x<0)head.x=cols-1;
        if(head.x>=cols)head.x=0;
        if(head.y<0)head.y=rows-1;
        if(head.y>=rows)head.y=0;

        // Self-collision only
        if(snake.some(s=>s.x===head.x&&s.y===head.y)){
            if(shieldActive){
                shieldActive=false;
                document.getElementById('gameMsg').innerHTML='<span class="warn">🛡️ Shield saved you!</span>';
                draw();return;
            }
            gameOver=true;
            if(navigator.vibrate)navigator.vibrate([100,50,200]);
            document.getElementById('gameMsg').innerHTML='<span class="warn">📉 MARGIN CALL — Portfolio liquidated</span>';
            VDna.addXp(Math.floor(portfolio/100));
            draw();return;
        }

        snake.unshift(head);
        let ate=false;

        for(let i=items.length-1;i>=0;i--){
            const item=items[i];
            if(item.x===head.x&&item.y===head.y){
                const def=ITEMS[item.type];
                if(item.type==='bomb'){
                    if(shieldActive){shieldActive=false;spawnParticles(item.x,item.y,'#22c55e',8);document.getElementById('gameMsg').innerHTML='🛡️ Shield blocked the crash!';}
                    else{portfolio+=def.value;pnl+=def.value;streak=0;spawnParticles(item.x,item.y,'#ef4444',12);if(navigator.vibrate)navigator.vibrate([50,30,100]);document.getElementById('gameMsg').innerHTML='<span class="warn">'+def.msg+'</span>';}
                } else {
                    const mult=level;const val=def.value*mult;
                    portfolio+=val;pnl+=val;streak++;
                    if(streak>bestStreak)bestStreak=streak;
                    spawnParticles(item.x,item.y,def.color,10);
                    if(navigator.vibrate)navigator.vibrate(20);
                    let msg=def.msg.replace(/\+\$\d+/,'+$'+val);
                    if(streak>=3)msg+=' 🔥×'+streak;
                    if(mult>1)msg+=' (Q'+level+' ×'+mult+')';
                    document.getElementById('gameMsg').innerHTML='<span class="bonus">'+msg+'</span>';
                    levelProgress++;
                    if(levelProgress>=10){level++;levelProgress=0;speed=Math.max(70,speed-8);if(snakeGame){clearInterval(snakeGame);snakeGame=setInterval(update,speed);}document.getElementById('gameMsg').innerHTML='<span class="bonus">📊 Quarter '+level+' — Speed up! ×'+level+' multiplier</span>';}
                    if(streak===5){shieldActive=true;document.getElementById('gameMsg').innerHTML='<span class="bonus">🛡️ Shield activated! Blocks 1 crash</span>';}
                }
                items.splice(i,1);ate=true;break;
            }
        }
        if(!ate)snake.pop();

        for(let i=items.length-1;i>=0;i--){items[i].timer--;if(items[i].timer<=0)items.splice(i,1);}
        if(items.length<2+level)spawnItem();
        if(moveCount%30===0&&items.length<6)spawnItem();

        particles.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.life--;});
        particles=particles.filter(p=>p.life>0);
        draw();
    }

    if(snakeGame)clearInterval(snakeGame);
    snakeGame=setInterval(update,speed);
    document.getElementById('gameMsg').textContent='Collect 💰 coins · Avoid 💣 bombs · Grow your portfolio';
    // Show touch hint then fade
    const touchHint=document.getElementById('gameTouchHint');
    if(touchHint){touchHint.style.opacity='1';touchHint.style.display='block';setTimeout(()=>{touchHint.style.opacity='0';},4000);}
    draw();

    const handler=e=>{
        if(!document.getElementById('gameOverlay').classList.contains('show')){document.removeEventListener('keydown',handler);return;}
        if(e.key==='r'||e.key==='R'){restartSnake();return;}
        const map={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};
        if(map[e.key]){const d=map[e.key];if(d.x!==-snakeDir.x||d.y!==-snakeDir.y){snakeDir=d;}e.preventDefault();}
    };
    document.addEventListener('keydown',handler);
}

// ═══ LIVE MARKET TICKER ═══
(function(){
    const CACHE_KEY='mktData';const CACHE_TTL=3600000;// 1 hour
    const tickerEl=document.getElementById('gameTicker');

    function formatTicker(data){
        return data.map(d=>{
            const cls=d.change>=0?'up':'down';
            const sign=d.change>=0?'+':'';
            return `<span class="${cls}">${d.symbol} ${d.price} ${sign}${d.change}%</span>`;
        }).join(' · ');
    }

    function renderTicker(data){
        if(!tickerEl)return;
        const html=formatTicker(data);
        tickerEl.innerHTML=html+' · '+html;// duplicate for seamless scroll
    }

    function getCached(){
        try{
            const raw=localStorage.getItem(CACHE_KEY);
            if(!raw)return null;
            const{data,ts}=JSON.parse(raw);
            if(Date.now()-ts<CACHE_TTL)return data;
        }catch(e){}
        return null;
    }

    function setCache(data){
        try{localStorage.setItem(CACHE_KEY,JSON.stringify({data,ts:Date.now()}));}catch(e){}
    }

    // Fallback static data (used if APIs fail)
    const FALLBACK=[
        {symbol:'BTC',price:'$67,432',change:2.4},
        {symbol:'ETH',price:'$3,521',change:1.8},
        {symbol:'GOLD',price:'$2,341',change:0.6},
        {symbol:'EUR/USD',price:'1.0842',change:-0.3},
        {symbol:'GBP/USD',price:'1.2714',change:0.1},
        {symbol:'USD/EGP',price:'50.65',change:-0.1},
        {symbol:'SPY',price:'$512.8',change:0.9},
        {symbol:'OIL',price:'$78.4',change:-1.2}
    ];

    async function fetchLiveData(){
        const results=[];
        try{
            // CoinGecko — free, no API key needed
            const cryptoRes=await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana,ripple&vs_currencies=usd&include_24hr_change=true');
            if(cryptoRes.ok){
                const crypto=await cryptoRes.json();
                const cryptoMap={bitcoin:'BTC',ethereum:'ETH',solana:'SOL',ripple:'XRP'};
                for(const[id,sym]of Object.entries(cryptoMap)){
                    if(crypto[id]){
                        const price=crypto[id].usd;
                        const change=crypto[id].usd_24h_change||0;
                        results.push({symbol:sym,price:'$'+price.toLocaleString(undefined,{maximumFractionDigits:price>100?0:2}),change:parseFloat(change.toFixed(1))});
                    }
                }
            }
        }catch(e){}

        try{
            // Open Exchange Rates via exchangerate-api (free tier)
            const fxRes=await fetch('https://open.er-api.com/v6/latest/USD');
            if(fxRes.ok){
                const fx=await fxRes.json();
                if(fx.rates){
                    const pairs=[
                        {sym:'EUR/USD',rate:1/fx.rates.EUR,prev:1.0850},
                        {sym:'GBP/USD',rate:1/fx.rates.GBP,prev:1.2700},
                        {sym:'USD/JPY',rate:fx.rates.JPY,prev:154.50},
                        {sym:'USD/EGP',rate:fx.rates.EGP,prev:50.50}
                    ];
                    pairs.forEach(p=>{
                        const change=((p.rate-p.prev)/p.prev*100);
                        results.push({symbol:p.sym,price:p.rate.toFixed(p.sym.includes('JPY')?2:4),change:parseFloat(change.toFixed(1))});
                    });
                }
            }
        }catch(e){}

        try{
            // Gold/Oil from metals API alternative — frankfurter for commodities proxy
            const goldRes=await fetch('https://api.coingecko.com/api/v3/simple/price?ids=tether-gold&vs_currencies=usd&include_24hr_change=true');
            if(goldRes.ok){
                const gold=await goldRes.json();
                if(gold['tether-gold']){
                    results.push({symbol:'GOLD',price:'$'+Math.round(gold['tether-gold'].usd).toLocaleString(),change:parseFloat((gold['tether-gold'].usd_24h_change||0).toFixed(1))});
                }
            }
        }catch(e){}

        return results.length>=3?results:null;
    }

    async function loadTicker(){
        // Try cache first
        const cached=getCached();
        if(cached){renderTicker(cached);return;}

        // Try live APIs
        const live=await fetchLiveData();
        if(live){setCache(live);renderTicker(live);return;}

        // Fallback
        renderTicker(FALLBACK);
    }

    // Load on game open and refresh every hour
    const origOpen=window.openGame;
    window.openGame=function(){
        origOpen();loadTicker();
    };
    // Also refresh periodically if game stays open
    setInterval(()=>{
        if(document.getElementById('gameOverlay').classList.contains('show')){
            localStorage.removeItem(CACHE_KEY);loadTicker();
        }
    },CACHE_TTL);
    // Pre-load on page load so it's ready
    loadTicker();
})();

// Full-screen touch swipe controls (replaces d-pad)
(function(){
    let tx=0,ty=0,touching=false;
    const el=document.getElementById('gameOverlay');
    el.addEventListener('touchstart',e=>{
        if(e.target.closest('.game-btn'))return;
        tx=e.touches[0].clientX;ty=e.touches[0].clientY;touching=true;
        e.preventDefault();// Prevent scroll while playing
    },{passive:false});
    el.addEventListener('touchmove',e=>{
        if(!touching||e.target.closest('.game-btn'))return;
        const dx=e.touches[0].clientX-tx,dy=e.touches[0].clientY-ty;
        if(Math.abs(dx)<20&&Math.abs(dy)<20)return;
        let d;
        if(Math.abs(dx)>Math.abs(dy)){d=dx>0?{x:1,y:0}:{x:-1,y:0};}else{d=dy>0?{x:0,y:1}:{x:0,y:-1};}
        if(d.x!==-snakeDir.x||d.y!==-snakeDir.y)snakeDir=d;
        tx=e.touches[0].clientX;ty=e.touches[0].clientY;// Reset for continuous swiping
        e.preventDefault();
    },{passive:false});
    el.addEventListener('touchend',()=>{touching=false;},{passive:true});
})();
// ═════════════════════════════════════════════════
// FEATURE: KEYBOARD SHORTCUTS
// ═════════════════════════════════════════════════
window.openShortcuts=function(){document.getElementById('shortcutOverlay').classList.add('show');};
window.closeShortcuts=function(){document.getElementById('shortcutOverlay').classList.remove('show');};

// ═════════════════════════════════════════════════
// FEATURE: CURSOR TRAIL (desktop only)
// ═════════════════════════════════════════════════
if(D&&!reducedMotion){
    const particles=[];
    document.addEventListener('mousemove',e=>{
        const p=document.createElement('div');p.className='cursor-particle';
        p.style.left=e.clientX+'px';p.style.top=e.clientY+'px';
        p.style.opacity='0.6';
        const hue=Math.random()*60+170;// cyan-purple range
        p.style.background=`hsl(${hue},100%,70%)`;
        p.style.width=(2+Math.random()*3)+'px';p.style.height=p.style.width;
        document.body.appendChild(p);
        const angle=Math.random()*Math.PI*2;const dist=10+Math.random()*20;
        const dx=Math.cos(angle)*dist;const dy=Math.sin(angle)*dist;
        requestAnimationFrame(()=>{
            p.style.transition='all .6s ease-out';
            p.style.transform=`translate(${dx}px,${dy}px)`;
            p.style.opacity='0';
        });
        setTimeout(()=>p.remove(),700);
    });
}

// ═════════════════════════════════════════════════
// UNIFIED KEYBOARD HANDLER (enhanced)
// ═════════════════════════════════════════════════
// Remove old keydown handler first — we'll replace with unified
(function(){
    const unifiedKeys=e=>{
        const tag=document.activeElement.tagName;
        if(tag==='INPUT'||tag==='TEXTAREA')return;// Don't capture when typing
        if(e.key==='Escape'){closeEgg();closeShare();closeTrophy();closeTerm();closeGame();closeShortcuts();}
        if(e.key==='t'&&!e.ctrlKey&&!e.metaKey)openTrophy();
        if(e.key==='?')openShortcuts();
        if(e.key==='`')openTerm();
        if(e.key==='g'&&!e.ctrlKey)openGame();
    };
    // Remove previous listeners (they're anonymous so can't remove — but our new unified one will work alongside)
    document.addEventListener('keydown',unifiedKeys);
})();

// ═════════════════════════════════════════════════
// FEATURE: SERVICE WORKER (Offline Mode)
// ═════════════════════════════════════════════════
if('serviceWorker' in navigator){
    // Register inline service worker via blob
    const swCode=`self.addEventListener('install',e=>{e.waitUntil(caches.open('amr-v1').then(c=>c.addAll(['/'])));self.skipWaiting();});self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request).then(res=>{if(res.ok){const clone=res.clone();caches.open('amr-v1').then(c=>c.put(e.request,clone));}return res;}).catch(()=>caches.match('/'))));});`;
    try{
        const blob=new Blob([swCode],{type:'application/javascript'});
        navigator.serviceWorker.register(URL.createObjectURL(blob),{scope:'/'}).catch(()=>{});
    }catch(e){}
}

// ═══ SCROLL & PARALLAX ═══
addEventListener('scroll',()=>{const t=scrollY,h=document.documentElement.scrollHeight-innerHeight;document.getElementById('sbar').style.width=(h>0?t/h*100:0)+'%';trackScroll();},{passive:true});
if(!reducedMotion){addEventListener('scroll',()=>{const y=scrollY;document.querySelectorAll('.mesh div').forEach((b,i)=>{b.style.transform=`translateY(${y*(i+1)*.06}px)`;});},{passive:true});}
})();
</script>
<script src="phase1-features.js" defer></script>
<script src="phase2-features.js" defer></script>
<script src="phase3-arcade.js" defer></script>
</body>
</html>
